================================================================================
RADAR NARCISISTA â€“ CHECKLIST DE TESTES
================================================================================
VersÃ£o: 1.8
Ãšltima atualizaÃ§Ã£o: 30/11/2025 17:50 (UTC-5)

================================================================================
FLUXO 1 â€“ TESTE DE CLAREZA
================================================================================

â˜ Consigo responder as 18+1 perguntas sem erro
â˜ Vejo o resultado com zona global + eixos + categorias
â˜ A opÃ§Ã£o "Guardar como base" funciona sem erro
â˜ Depois de guardar, o Dashboard mostra recomendaÃ§Ãµes baseadas nesse teste
â˜ Posso refazer o teste e ver histÃ³rico

================================================================================
FLUXO 2 â€“ DIÃRIO
================================================================================

â˜ Consigo criar um diÃ¡rio normal (sem teste)
â˜ Consigo criar um diÃ¡rio vinculado Ã  base de clareza
â˜ O diÃ¡rio aparece na timeline em ordem correta
â˜ Se faÃ§o login/logout, os diÃ¡rios continuam lÃ¡
â˜ Posso editar um diÃ¡rio existente
â˜ Posso excluir um diÃ¡rio
â˜ A anÃ¡lise de IA funciona no diÃ¡rio

================================================================================
FLUXO 3 â€“ CHAT / COACH IA
================================================================================

â˜ Consigo abrir o chat logado
â˜ A IA fala como "Radar Narcisista", nÃ£o genÃ©rico
â˜ A IA usa contexto do teste (zona, risco) na resposta
â˜ A IA usa contexto do diÃ¡rio recente
â˜ Limite de mensagens por plano funciona
â˜ Mensagem de limite atingido aparece corretamente
â˜ BotÃ£o "Salvar no DiÃ¡rio" aparece apÃ³s 2+ mensagens
â˜ Modal de resumo permite editar texto, intensidade e tags
â˜ Resumo salvo aparece no DiÃ¡rio com badge "Resumo do Chat"
â˜ Modal de encerramento oferece opÃ§Ã£o de salvar resumo

================================================================================
FLUXO 4 â€“ FRONTPAGE / PLANOS
================================================================================

â˜ Homepage abre sem erro em aba anÃ´nima
â˜ As seÃ§Ãµes principais aparecem (hero, ferramentas, planos, FAQ)
â˜ BotÃ£o de cada plano leva para onde deveria
â˜ Planos sÃ£o carregados do banco (ou fallback funciona)
â˜ PromoÃ§Ãµes ativas aparecem com labels
â˜ PreÃ§o original riscado aparece quando hÃ¡ promoÃ§Ã£o

================================================================================
FLUXO 5 â€“ ADMIN / PLANOS
================================================================================

â˜ Consigo acessar /admin/planos como admin
â˜ Vejo lista de todos os planos (B2C e B2B)
â˜ Consigo editar nome, preÃ§o e limites de um plano
â˜ Consigo criar uma promoÃ§Ã£o com data de inÃ­cio/fim
â˜ Consigo ativar/desativar promoÃ§Ã£o
â˜ AlteraÃ§Ãµes refletem na frontpage

================================================================================
FLUXO 6 â€“ AUTENTICAÃ‡ÃƒO
================================================================================

â˜ Consigo criar conta nova
â˜ Consigo fazer login
â˜ Consigo fazer logout
â˜ Consigo recuperar senha
â˜ SessÃ£o persiste apÃ³s fechar navegador

================================================================================
FLUXO 7 â€“ LGPD / CONFIGURAÃ‡Ã•ES
================================================================================

â˜ Consigo exportar meus dados
â˜ Consigo solicitar exclusÃ£o de conta
â˜ Aceite de termos funciona
â˜ HistÃ³rico de aceites Ã© registrado

================================================================================
TESTES AUTOMATIZADOS (JEST)
================================================================================

â˜ npm run test passa sem erros
â˜ Cobertura mÃ­nima de 50%

================================================================================
TESTES DE BUILD
================================================================================

â˜ npm run build passa sem erros
â˜ Deploy na Vercel funciona
â˜ NÃ£o hÃ¡ erros de TypeScript

================================================================================
LEGENDA
================================================================================

â˜ = NÃ£o testado / Pendente
â˜‘ = Testado e funcionando
âœ— = Testado e com problema

================================================================================
TESTES REALIZADOS (29-30/11/2025)
================================================================================

FLUXO 5 â€“ ADMIN / PLANOS:
â˜‘ Consigo acessar /admin/planos como admin (CORRIGIDO)
â˜‘ Vejo lista de todos os planos (B2C e B2B)
â˜ Consigo editar nome, preÃ§o e limites de um plano
â˜‘ Consigo criar uma promoÃ§Ã£o com data de inÃ­cio/fim (RLS CORRIGIDO)
â˜ Consigo ativar/desativar promoÃ§Ã£o
â˜ AlteraÃ§Ãµes refletem na frontpage

FLUXO 6 â€“ AUTENTICAÃ‡ÃƒO:
â˜‘ Consigo fazer login com etailoffice@gmail.com
â˜‘ Admin Ã© reconhecido corretamente apÃ³s correÃ§Ã£o

TESTES DE BUILD:
â˜‘ npm run build passa sem erros (129 pÃ¡ginas)
â˜‘ Deploy na Vercel funciona
â˜‘ NÃ£o hÃ¡ erros de TypeScript

CORREÃ‡Ã•ES APLICADAS:
â˜‘ BotÃ£o "Config Menu" agora vai para /admin/menu-config (nÃ£o localhost)
â˜‘ DiÃ¡rio unificado - rotas duplicadas arquivadas em app/_archive/
â˜‘ Links do dashboard atualizados para rotas oficiais
â˜‘ Build passou com 129 pÃ¡ginas
â˜‘ Badge "Perfil de Clareza" implementado no DiÃ¡rio
â˜‘ Badge "Perfil de Clareza" + "Intenso" implementado na Timeline
â˜‘ Tipos JournalEntryType adicionados em types/database.ts

ROTAS OFICIAIS DO DIÃRIO:
â˜‘ /diario â†’ Lista de entradas
â˜‘ /diario/novo â†’ Criar entrada
â˜‘ /diario/[id] â†’ Visualizar entrada
â˜‘ /diario/[id]/editar â†’ Editar entrada
â˜‘ /diario/timeline â†’ Timeline de PadrÃµes

ETAPA 2 - TRIÃ‚NGULO CLAREZA â‡„ DIÃRIO â‡„ CHAT:
â˜ Fazer Teste de Clareza e salvar como base â†’ Deve criar entrada no diÃ¡rio
â˜ Entrada criada deve ter entry_type = 'clarity_baseline'
â˜ Entrada criada deve ter clarity_test_id preenchido
â˜ Chat deve receber contexto dos episÃ³dios recentes do diÃ¡rio
â˜ Chat deve receber perfil de clareza do usuÃ¡rio
â˜ Verificar logs no console do servidor (Vercel) para confirmar injeÃ§Ã£o de contexto
â˜ Acessar /diario/novo?from=clarity_result â†’ Deve prÃ©-preencher formulÃ¡rio
â˜ FormulÃ¡rio prÃ©-preenchido deve ter tÃ­tulo, tags e descriÃ§Ã£o do perfil de clareza

MIGRATION OBRIGATÃ“RIA (executar no Supabase):
ALTER TABLE public.journal_entries 
ADD COLUMN IF NOT EXISTS entry_type TEXT DEFAULT 'normal';

ALTER TABLE public.journal_entries 
ADD COLUMN IF NOT EXISTS clarity_test_id UUID REFERENCES public.clarity_tests(id);

ETAPA 3 - DIÃRIO + TIMELINE + DASHBOARD CONECTADOS AO TRIÃ‚NGULO:
â˜ /diario â†’ Entradas clarity_baseline devem mostrar badge "Perfil de Clareza"
â˜ /diario/timeline â†’ Entradas clarity_baseline devem mostrar badge "Perfil de Clareza"
â˜ /diario/timeline â†’ Entradas com mood_intensity >= 7 devem mostrar badge "Intenso"
â˜ /dashboard â†’ Deve mostrar dados reais de clareza (nÃ£o mock)
â˜ /dashboard â†’ Deve mostrar Ãºltimas entradas do diÃ¡rio reais
â˜ /dashboard â†’ EstatÃ­sticas (testes, episÃ³dios, mensagens) devem ser reais
â˜ Fluxo completo: Teste Clareza â†’ Salvar Base â†’ Ver entrada no DiÃ¡rio com badge
â˜ Fluxo completo: Teste Clareza â†’ Salvar Base â†’ Ver entrada na Timeline com badge

ETAPA 4 - CHAT â†’ DIÃRIO (SALVAR RESUMO):
â˜ API /api/chat/save-summary funciona (POST com auth)
â˜ BotÃ£o "Salvar no DiÃ¡rio" aparece no header do chat apÃ³s 2+ mensagens do usuÃ¡rio
â˜ Modal de resumo abre ao clicar no botÃ£o
â˜ Modal permite editar texto, ajustar intensidade (slider 0-10) e tags
â˜ Ao salvar, cria entrada no diÃ¡rio com entry_type = 'chat_summary'
â˜ Entrada salva aparece no /diario com badge "Resumo do Chat" (ğŸ’¬)
â˜ Entrada salva aparece no /diario/timeline com badge "Resumo do Chat"
â˜ Modal de encerramento de conversa oferece checkbox para salvar resumo
â˜ Se marcar checkbox e clicar "Continuar para salvar resumo", abre modal de resumo
â˜ Fluxo completo: Chat â†’ Salvar resumo â†’ Ver no DiÃ¡rio com badge

================================================================================
ETAPA 5 - EDITOR VISUAL DA FRONTPAGE:
================================================================================

â˜ Migration 007_frontpage_config.sql executada no Supabase
â˜ Tabela frontpage_config criada com dados seed
â˜ API /api/admin/frontpage-editor funciona (GET retorna configs)
â˜ API /api/admin/frontpage-editor funciona (PUT atualiza config)
â˜ /admin/frontpage-editor carrega sem erro
â˜ Editor de Hero permite editar tÃ­tulo, subtÃ­tulo e CTAs
â˜ Editor de FAQ permite adicionar/remover perguntas
â˜ Editor de Depoimentos permite adicionar/remover itens
â˜ BotÃ£o "Salvar" atualiza dados no banco
â˜ /admin/frontpage-visual carrega sem erro
â˜ Preview mostra alteraÃ§Ãµes em tempo real
â˜ Preview responsivo funciona (desktop/tablet/mobile)
â˜ AlteraÃ§Ãµes salvas refletem na frontpage real
â˜ Fallback funciona se tabela nÃ£o existir

================================================================================
ETAPA 6 - TRIÃ‚NGULO V2 (FILTROS + MAPA NO DASHBOARD):
================================================================================

FILTROS NO /diario:
â˜ Filtro "Todos" mostra todas as entradas
â˜ Filtro "Perfil de Clareza" mostra apenas entries clarity_baseline
â˜ Filtro "Resumo do Chat" mostra apenas entries chat_summary
â˜ Filtro "EpisÃ³dios Normais" mostra apenas entries normal ou sem tipo
â˜ Mensagem amigÃ¡vel quando filtro nÃ£o retorna resultados
â˜ Badges existentes continuam funcionando

FILTROS + LEGENDA NO /diario/timeline:
â˜ Filtros por entry_type funcionam igual ao /diario
â˜ Legenda do TriÃ¢ngulo aparece corretamente:
   - âœ¨ Perfil de Clareza
   - ğŸ’¬ Resumo do Chat
   - ğŸ”¥ EpisÃ³dio Intenso (â‰¥7)
â˜ Filtro nÃ£o quebra a timeline existente

CARD "ESTADO DO TRIÃ‚NGULO" NO /dashboard:
â˜ Card aparece na seÃ§Ã£o correta do dashboard
â˜ Coluna "Clareza" mostra se tem Perfil base salvo
â˜ Coluna "DiÃ¡rio" mostra contagem dos Ãºltimos 30 dias
â˜ Coluna "Chat" mostra contagem de resumos dos Ãºltimos 30 dias
â˜ Status "TriÃ¢ngulo Ativo" aparece quando os 3 lados tÃªm dados
â˜ Status "Incompleto" aparece quando falta algum lado
â˜ Mensagem explicativa indica o que falta completar
â˜ Card funciona em tema claro e escuro

================================================================================
ETAPA 7.3 - PLANO DE SEGURANÃ‡A NO TRIÃ‚NGULO:
================================================================================

API /api/safety-plan:
â˜ GET /api/safety-plan retorna plano do usuÃ¡rio autenticado
â˜ GET /api/safety-plan retorna status calculado (NOT_STARTED, IN_PROGRESS, READY)
â˜ POST /api/safety-plan cria novo plano
â˜ POST /api/safety-plan cria entrada no diÃ¡rio com entry_type='safety_plan'
â˜ PATCH /api/safety-plan atualiza plano existente
â˜ PATCH /api/safety-plan cria entrada no diÃ¡rio de atualizaÃ§Ã£o
â˜ API retorna 401 se nÃ£o autenticado
â˜ API retorna 409 se tentar criar plano que jÃ¡ existe

DASHBOARD - Card "Plano de SeguranÃ§a":
â˜ Card aparece no Dashboard
â˜ Card mostra status NOT_STARTED com cor cinza
â˜ Card mostra status IN_PROGRESS com cor amarela
â˜ Card mostra status READY com cor verde
â˜ Card tem link para /plano-seguranca
â˜ Card mostra contagem de contatos de emergÃªncia

DASHBOARD - Banner de Risco FÃ­sico:
â˜ Banner aparece se hasPhysicalRisk = true E plano nÃ£o estÃ¡ READY
â˜ Banner NÃƒO aparece se plano estÃ¡ READY
â˜ Banner tem cor vermelha se plano NOT_STARTED
â˜ Banner tem cor amarela se plano IN_PROGRESS
â˜ Banner tem link para /plano-seguranca

CHAT - DetecÃ§Ã£o de Risco FÃ­sico:
â˜ Digitar "ele me bateu" mostra banner de alerta
â˜ Digitar "me ameaÃ§ou" mostra banner de alerta
â˜ Digitar "medo de morrer" mostra banner de alerta
â˜ Banner tem link para /plano-seguranca
â˜ risk_alert Ã© criado no banco de dados
â˜ risk_alert tem source='chat', level='HIGH', category='PHYSICAL_VIOLENCE'

DIÃRIO - Badge "Plano de SeguranÃ§a":
â˜ Entradas com entry_type='safety_plan' mostram badge ğŸ›¡ï¸
â˜ Badge aparece no /diario
â˜ Badge aparece no /diario/timeline
â˜ Badge tem estilo vermelho

TESTE DE CLAREZA - risk_alert automÃ¡tico:
â˜ Ao salvar perfil com hasPhysicalRisk=true, cria risk_alert
â˜ risk_alert tem category='PHYSICAL_VIOLENCE'

FLUXO COMPLETO:
â˜ Criar Plano de SeguranÃ§a â†’ Ver entrada no DiÃ¡rio com badge ğŸ›¡ï¸
â˜ Atualizar Plano de SeguranÃ§a â†’ Ver nova entrada no DiÃ¡rio
â˜ Digitar frase de risco no Chat â†’ Ver banner + risk_alert criado
â˜ Fazer teste com risco fÃ­sico â†’ Ver risk_alert criado

================================================================================
ETAPA 7.4 â€“ QA TRIÃ‚NGULO + PLANO DE SEGURANÃ‡A (30/11/2025)
================================================================================

OBJETIVO: Validar que a ETAPA 7.3 funciona corretamente e nÃ£o abre buracos de seguranÃ§a.

T1 â€“ TESTE DE CLAREZA COM RISCO FÃSICO:
â˜ Teste com categoria fÃ­sica >= 30% marca has_physical_risk = true
â˜ risk_alert Ã© criado com source='clarity_test', category='PHYSICAL_VIOLENCE'
â˜ Dashboard mostra banner de risco fÃ­sico
â˜ Card do Plano de SeguranÃ§a reflete o status correto

T2 â€“ CHAT COM RISCO FÃSICO (REGEX):
â˜ Mensagem "ele me bateu" dispara detecÃ§Ã£o
â˜ Mensagem "me ameaÃ§ou" dispara detecÃ§Ã£o
â˜ Mensagem "medo de morrer" dispara detecÃ§Ã£o
â˜ Banner vermelho aparece no chat
â˜ risk_alert Ã© criado com source='chat', level='HIGH'
â˜ Resposta da IA nÃ£o quebra apÃ³s detecÃ§Ã£o

T3 â€“ PLANO DE SEGURANÃ‡A + DIÃRIO:
â˜ POST /api/safety-plan cria plano + entrada no diÃ¡rio
â˜ PATCH /api/safety-plan atualiza plano + entrada no diÃ¡rio
â˜ entry_type='safety_plan' estÃ¡ correto na entrada
â˜ Badge ğŸ›¡ï¸ aparece no /diario
â˜ Badge ğŸ›¡ï¸ aparece no /diario/timeline

T4 â€“ DASHBOARD (CARD + BANNERS):
â˜ Card mostra NOT_STARTED (cinza) quando nÃ£o hÃ¡ plano
â˜ Card mostra IN_PROGRESS (amarelo) quando plano incompleto
â˜ Card mostra READY (verde) quando plano completo
â˜ Banner vermelho aparece: hasPhysicalRisk + NOT_STARTED
â˜ Banner amarelo aparece: hasPhysicalRisk + IN_PROGRESS
â˜ Banner NÃƒO aparece: hasPhysicalRisk + READY
â˜ NÃ£o hÃ¡ crash se nÃ£o existir plano

T5 â€“ SEGURANÃ‡A / RLS:
â˜ /api/safety-plan filtra por user_id do usuÃ¡rio logado
â˜ /api/clarity/activate-profile filtra por user_id
â˜ /api/chat/route.ts (risk_alert) filtra por user_id
â˜ UsuÃ¡rio A nÃ£o consegue ver dados do UsuÃ¡rio B
â˜ Tabelas safety_plans, risk_alerts, journal_entries tÃªm RLS ativo

STATUS DOS TESTES (30/11/2025 16:45):
- T1: [X] PASS â€“ risk_alert criado corretamente, filtra por user_id
- T2: [X] PASS â€“ regex funciona, backend usa user autenticado
- T3: [X] PASS â€“ entry_type='safety_plan', diÃ¡rio criado
- T4: [X] PASS â€“ card/banners funcionam, sem crash
- T5: [X] PASS â€“ todas APIs filtram por user_id autenticado

================================================================================
MIGRATIONS PENDENTES (EXECUTAR NO SUPABASE):
================================================================================

1. 007_frontpage_config.sql
   - Cria tabela frontpage_config
   - Insere dados seed (hero, faq, testimonials, etc.)
   - Configura RLS para admins

================================================================================
FIM DO CHECKLIST DE TESTES
================================================================================
