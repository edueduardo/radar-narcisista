================================================================================
RADAR NARCISISTA ‚Äì ATLAS COMPLETO DO PROJETO (C√ìDIGO REAL)
================================================================================
Data/hora da gera√ß√£o: 30/11/2025 20:20 (UTC-5)
Ambiente: projeto local do Eduardo (Windsurf)
Gerado por: Windsurf AI (Cascade)

√öLTIMA ATUALIZA√á√ÉO: 03/12/2025 15:30 (UTC-5)

================================================================================
UI CORE REGISTRY - REGISTRO CENTRAL DE INTERFACES (03/12/2025)
================================================================================

üìä STATUS: ‚úÖ IMPLEMENTADO

üìÅ ARQUIVO: lib/ui-core-registry.ts

FONTE DA VERDADE para todas as telas do sistema.
A partir dele s√£o constru√≠dos:
- Menu do ADMIN
- Dashboard da USU√ÅRIA
- Dashboard do PROFISSIONAL
- Painel WHITE-LABEL
- Painel GERADOR DE SAAS

ESTAT√çSTICAS:
| Audience | Grupos | Telas |
|----------|--------|-------|
| admin | 8 | 55 |
| user | 5 | 17 |
| professional | 4 | 8 |
| whitelabel | 4 | 8 |
| generator | 4 | 8 |
| TOTAL | 25 | 96 |

REGRA: Todo novo menu/tela/dash DEVE ser registrado aqui.

================================================================================
ADMIN MENU CORE - ORGANIZA√á√ÉO DO MENU ADMINISTRATIVO (03/12/2025)
================================================================================

üìä STATUS: ‚úÖ IMPLEMENTADO

üìÅ ARQUIVO: lib/admin-core-menu.ts

ORGANIZA√á√ÉO EM 8 GRUPOS:
| # | Grupo | √çcone | Itens |
|---|-------|-------|-------|
| 1 | Vis√£o Geral & Controle | üéØ | 9 |
| 2 | Pessoas & Acessos | üë• | 5 |
| 3 | Planos, Billing & Promo√ß√µes | üí≥ | 5 |
| 4 | IAs & Orquestra√ß√£o | ü§ñ | 10 |
| 5 | Produto & Funcionalidades | üéØ | 7 |
| 6 | Front & Conte√∫dos | üé® | 8 |
| 7 | Governan√ßa & LGPD | ‚öñÔ∏è | 5 |
| 8 | Laborat√≥rio & Dev | üß™ | 6 |

TOTAL: 55 itens de menu (43 implementados, 12 placeholders)

REUTILIZA√á√ÉO:
- RADAR (projeto m√£e) - usa diretamente
- GERADOR DE SAAS - copia como base
- WHITE LABEL - herda estrutura

================================================================================
AI_PERSONAS - SISTEMA DE AVATARES DE IA (03/12/2025)
================================================================================

üìä STATUS: ‚è≥ SQL PRONTO, PENDENTE EXECU√á√ÉO

üìÅ SQL: database/migrate-ai-personas.sql

‚úÖ TABELAS (5):
| Tabela | Descri√ß√£o |
|--------|-----------|
| ai_providers | Provedores reais (vis√£o admin) |
| ai_personas | Avatares/Personas (vis√£o usu√°rio) |
| ai_persona_bindings | Liga√ß√£o Persona ‚Üí Contexto |
| ai_persona_logs | Logs de uso |
| ai_transparency_settings | Configura√ß√µes de transpar√™ncia |

‚úÖ PERSONAS PADR√ÉO (6):
- Mentora Calma üïäÔ∏è
- Analista L√≥gico üß†
- Guardi√£o de Seguran√ßa üõ°Ô∏è
- Curador de Conte√∫do üìö
- Assistente Profissional üíº
- Or√°culo do Sistema üîÆ

‚úÖ P√ÅGINAS:
- /admin/ia-personas - Cockpit de Personas

‚úÖ SERVI√áOS:
- lib/ai-personas.ts - Fun√ß√µes de personas
- components/chat/PersonaSelector.tsx - Seletor de persona

================================================================================
MENU HELP - SISTEMA DE AJUDA EMBUTIDA (03/12/2025)
================================================================================

üìä STATUS: ‚úÖ IMPLEMENTADO

üìÅ ARQUIVOS:
- lib/menu-help-registry.ts - Registry de helps
- components/MenuHelpModal.tsx - Componentes de UI
- docs/MENU-HELP-ADMIN.md - Documenta√ß√£o

MENUS COBERTOS: 17
- Admin: 9 menus
- Usu√°ria: 5 menus
- Profissional: 1 menu
- White Label: 1 menu
- Gerador: 1 menu

================================================================================
AI_CONFIG_CORE - SISTEMA DE CONFIGURA√á√ÉO DE IAs (03/12/2025)
================================================================================

üìä STATUS: ‚úÖ IMPLEMENTADO E EXECUTADO NO SUPABASE

‚úÖ TABELAS CRIADAS (8):
| Tabela | Descri√ß√£o | Registros |
|--------|-----------|-----------|
| ai_providers_core | Provedores de IA | 5 |
| ai_features_core | Features de IA | 8 |
| ai_feature_providers_core | Relacionamento | - |
| ai_plan_matrix | Configura√ß√£o por plano | - |
| ai_group_overrides | Overrides por grupo | - |
| ai_feature_menu_map | Mapeamento de menus | 8 |
| ai_usage_stats_daily | Estat√≠sticas di√°rias | - |
| ai_usage_logs | Logs detalhados | - |

‚úÖ VIEWS CRIADAS (3):
- ai_usage_by_provider
- ai_usage_by_feature
- ai_usage_by_plan

‚úÖ FUN√á√ïES CRIADAS:
- ai_get_providers_for_context(perfil, feature, plan)

‚úÖ P√ÅGINAS ADMIN:
- /admin/ia-matrix - Configurar IAs por plano
- /admin/ia-mapa-menus - Ver IAs por menu
- /admin/ia-carga - Dashboard de uso

‚úÖ SERVI√áO:
- lib/ai-config-core.ts - M√©todos do PATCH 31-35

üìÅ SQL: database/migrate-ai-config-core-SIMPLES.sql

================================================================================
PLANOS_CORE - SISTEMA DE FEATURES E PLANOS (03/12/2025)
================================================================================

üìä STATUS: ‚è≥ SQL PRONTO, PENDENTE EXECU√á√ÉO

‚úÖ TABELAS (6):
| Tabela | Descri√ß√£o |
|--------|-----------|
| features | Features at√¥micas (16 features) |
| feature_profiles | Perfis versionados (4 profiles) |
| feature_profile_features | Relacionamento |
| plan_catalog | Cat√°logo de planos (4 planos) |
| user_feature_overrides | Overrides individuais |
| user_subscriptions_core | Assinaturas |

‚úÖ FUN√á√ïES:
- get_effective_features(user_id) - Retorna features efetivas
- has_feature(user_id, feature_key) - Verifica acesso
- get_feature_limit(user_id, feature_key, periodo) - Retorna limite

‚úÖ MELHORIAS APLICADAS:
- Coluna plan_key adicionada (alias de plan_slug)
- √çndice composto idx_fpf_profile_feature
- √çndice idx_user_subs_plan_key

üìÅ SQL: database/migrate-planos-core.sql

================================================================================
CONTROL PLANE GLOBAL (03/12/2025)
================================================================================

üìä STATUS: ‚úÖ DOCUMENTADO

üìÅ ARQUIVO: docs/CONTROL-PLANE.md

TR√äS CAMADAS:
1. C√ìDIGO (APP) - Muda com deploy
2. CONFIGURA√á√ÉO (BANCO) - Muda sem deploy
3. CONTROL PLANE (PAINEL) - Interface de gest√£o

MODOS DE ADMINISTRA√á√ÉO:
- MODO A: Admin local (/admin) - ATUAL
- MODO B: Control Hub externo - FUTURO (BLOCO 46-50)

================================================================================
AUDITORIA ETAPA 7.2 ‚Äì PLANO DE INTEGRA√á√ÉO (02/12/2025 21:00)
================================================================================

üìä STATUS: 90% IMPLEMENTADO - MVP FUNCIONAL

‚úÖ IMPLEMENTADO (10/14 itens):
| Item | Arquivo | Linhas |
|------|---------|--------|
| API /api/safety-plan | app/api/safety-plan/route.ts | 1-332 |
| Tipo 'safety_plan' | types/database.ts | 44 |
| Card Dashboard | app/dashboard/page.tsx | 1121-1160 |
| Banner risco Dashboard | app/dashboard/page.tsx | 1036-1118 |
| Regex Chat | app/chat/page.tsx | 373 |
| Banner Chat | app/chat/page.tsx | 126 |
| risk_alert Chat | app/chat/page.tsx | 375-410 |
| risk_alert Clareza | app/api/clarity/activate-profile/route.ts | 290-315 |
| Badge Di√°rio | app/diario/page.tsx | 356-363 |
| Badge Timeline | app/diario/timeline/page.tsx | 673-677 |

‚ö†Ô∏è PENDENTE-V2 (4/14 itens):
- Detec√ß√£o via Di√°rio (tags graves)
- Detec√ß√£o via IA (an√°lise sem√¢ntica)
- Centro de alertas no Dashboard
- Notifica√ß√µes push/email

üìÅ ARQUIVO DETALHADO: ANALISE-ETAPA-7.2-IMPLEMENTACAO.md

================================================================================
MUDAN√áAS RECENTES (02/12/2025 19:00 ‚Üí 19:30) - BLOCO 32-35 EM ANDAMENTO
================================================================================

üöÄ BLOCO 32-35 - CONTROL TOWER, TELEMETRIA, HELP DESK E GERADOR DE SAAS

‚úÖ ETAPA 32 - CONTROL TOWER & REGISTRO GLOBAL DE PROJETOS
- database/migrate-control-tower.sql - Tabelas:
  - projects_core (registro de todos os projetos)
  - owners_core (donos/respons√°veis)
  - project_flags_core (flags por projeto)
- lib/control-tower.ts - Helpers completos
- app/api/admin/control-tower/route.ts - API CRUD
- app/api/admin/control-tower/[id]/route.ts - Detalhes
- app/admin/control-tower/page.tsx - UI completa
- admin-features-registry.ts atualizado

‚úÖ ETAPA 33 - TELEMETRIA CORE PARA TODOS OS SAAS
- database/migrate-telemetry-core.sql - Tabelas:
  - telemetry_heartbeats_core (heartbeats)
  - telemetry_errors_core (erros)
  - telemetry_metrics_core (m√©tricas agregadas)
- lib/telemetry-core.ts - Helpers completos
- app/api/core/telemetry/heartbeat/route.ts - API heartbeat
- app/api/core/telemetry/error/route.ts - API erros

‚úÖ ETAPA 34 - HELP DESK GLOBAL E REPORTAR PROBLEMA
- database/migrate-helpdesk-core.sql - Tabelas:
  - support_tickets_core (tickets)
  - support_ticket_messages_core (mensagens)
- lib/helpdesk-core.ts - Helpers completos
- app/api/core/support-ticket/route.ts - API tickets
- components/SupportTicketButton.tsx - Bot√£o reutiliz√°vel
- app/admin/control-tower/helpdesk/page.tsx - UI Help Desk

üîÑ ETAPA 35 - V√çNCULO, DESV√çNCULO E VIDA PR√ìPRIA DOS FILHOS
- Campos vinculo_nucleo e politica_suporte j√° em projects_core
- docs/CONTROL-TOWER.md - Documenta√ß√£o completa

================================================================================
BLOCO 26-30 COMPLETO (ANTERIOR)
================================================================================

üéâ BLOCO 26-30 COMPLETO - OR√ÅCULO V2 MULTIPERFIL + INFRA COMUNICA√á√ÉO IA

‚úÖ ETAPA 26 - TEMPLATE DE RESUMO + CHECKLIST + REGRAS DE LINGUAGEM
- docs/FORMATO-RESUMO-ETAPAS.md v3.0
- docs/REGRAS-COMUNICACAO-IA.md v2.0
- docs/CHECKLIST-RESUMO-IA.md v2.0
- scripts/validar-resumo-ia.ts atualizado

‚úÖ ETAPA 27 - ORACULO_V2_CORE (N√öCLEO REUTILIZ√ÅVEL)
- lib/oraculo-core.ts - N√∫cleo completo com:
  - buildSystemPrompt(), buildUserContext(), parseOraculoResponse()
  - callOraculo() - fun√ß√£o principal
  - buildInstancePrompt() - suporte a inst√¢ncias whitelabel
  - Prompts por perfil: admin, usuaria, profissional, dev, whitelabel
- docs/ORACULO-CORE.md - Documenta√ß√£o t√©cnica completa

‚úÖ ETAPA 28 - INFRA MULTIPERFIL (FLAGS POR PLANO/PERFIL)
- lib/oraculo-settings.ts - Helpers de permiss√µes:
  - canUseOraculo(), registerOraculoUsage()
  - getOraculoSettings(), updateOraculoSettings()
  - listAllOraculoSettings(), getOraculoUsage()
- database/migrate-oraculo-settings.sql:
  - Tabela oraculo_plan_settings (status, limites)
  - Tabela oraculo_usage (contadores por per√≠odo)
  - Fun√ß√µes SQL: can_use_oraculo(), register_oraculo_usage()
- app/api/oraculo-v2/route.ts integrado com settings

‚úÖ ETAPA 29 - OR√ÅCULO V2 PARA NOVOS PERFIS (FASE 1)
- components/OraculoMultiperfil.tsx - UI completa:
  - Suporte a todos os perfis
  - Cores e sugest√µes por perfil
  - Exibi√ß√£o de limites de uso
  - Mensagens de seguran√ßa
- components/OraculoHint.tsx - Dicas contextuais

‚úÖ ETAPA 30 - INTEGRA√á√ÉO COM GERADOR DE SAAS + QA
- docs/ORACULO-CORE-SAAS.md - Guia completo de integra√ß√£o:
  - Arquitetura de integra√ß√£o
  - Passo a passo de implementa√ß√£o
  - Customiza√ß√£o de prompts e perfis
  - Checklist de seguran√ßa e deploy

================================================================================
MUDAN√áAS ANTERIORES (01/12/2025 22:40 ‚Üí 23:35)
================================================================================

üéâ BLOCO 40-44 CONCLU√çDO!

- ETAPA 42: DASHBOARD ANALYTICS AVAN√áADO (‚úÖ CONCLU√çDO)
  - app/admin/analytics-dashboard/page.tsx criado
  - 6 cards de m√©tricas com varia√ß√£o percentual
  - Gr√°ficos: √°rea (queries), barras (tokens), pizza (status), horizontal (inst√¢ncias)
  - Filtro de per√≠odo: 7, 30, 90 dias
  - Tabela detalhada por inst√¢ncia
  - Build passou: 170 p√°ginas

- ETAPA 43: ALERTAS AUTOM√ÅTICOS (‚úÖ CONCLU√çDO)
  - lib/oraculo-alerts.ts criado
  - database/migrate-oraculo-alerts.sql criado
  - Tipos: quota_warning, quota_exceeded, error_spike, latency_high, api_key_expiring
  - Severidades: info, warning, error, critical
  - Fun√ß√µes: createAlert, listAlerts, markAlertAsRead, resolveAlert, checkAndCreateAlerts

- ETAPA 44: EXPORTA√á√ÉO DE RELAT√ìRIOS (‚úÖ CONCLU√çDO)
  - app/admin/analytics-dashboard/export/page.tsx criado
  - Formatos: CSV, JSON, PDF
  - Tipos: queries, tokens, instances, billing, full
  - Filtro por per√≠odo e inst√¢ncia
  - Download autom√°tico

- Builder.io instalado (@builder.io/react, @builder.io/sdk)
- app/admin/builder/page.tsx criado (p√°gina de configura√ß√£o)
- admin-features-registry.ts atualizado com novas p√°ginas

================================================================================
MUDAN√áAS ANTERIORES (01/12/2025 21:45 ‚Üí 22:40)
================================================================================

üéâ BLOCO 36-39 CONCLU√çDO!

- ETAPA 39: LOGS DETALHADOS DE USO (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-usage-logs.sql criado
  - lib/oraculo-usage-logs.ts criado
  - app/api/admin/oraculo-instances/[id]/logs/route.ts criado
  - Integra√ß√£o na API p√∫blica (logging autom√°tico)
  - UI de logs na p√°gina de inst√¢ncia
  - Build passou: 166 p√°ginas

- ETAPA 40: DOCUMENTA√á√ÉO INTERATIVA DA API (‚úÖ CONCLU√çDO)
  - app/docs/api/page.tsx criado
  - Exemplos em JavaScript, Python, cURL, PHP
  - Playground para testar endpoints
  - Documenta√ß√£o de webhooks
  - Build passou: 167 p√°ginas

- ETAPA 41: TESTES AUTOMATIZADOS (‚úÖ CONCLU√çDO)
  - lib/__tests__/oraculo-instances.test.ts criado
  - lib/__tests__/oraculo-api-keys.test.ts criado
  - lib/__tests__/oraculo-billing.test.ts criado
  - vitest.config.ts e vitest.setup.ts criados
  - package.json atualizado com scripts de teste
  - Build passou: 167 p√°ginas

================================================================================
MUDAN√áAS ANTERIORES (01/12/2025 21:00 ‚Üí 21:45)
================================================================================

- ETAPA 30: INTEGRA√á√ÉO GERADOR DE SAAS + QA (‚úÖ CONCLU√çDO)
  - docs/ORACULO-CORE-SAAS.md criado (guia de integra√ß√£o)
  - lib/__tests__/oraculo-core.test.ts criado (testes unit√°rios)
  - Build passou: 163 p√°ginas
  - üéâ BLOCO 26-30 CONCLU√çDO!

- ETAPA 31: REFORMA INTELIGENTE DA FRONT PAGE (‚úÖ CONCLU√çDO)
  - Se√ß√£o "Para Quem √© o Radar" adicionada
  - 4 cards segmentados: Pessoas, Profissionais, ONGs, Whitelabel
  - Build passou: 163 p√°ginas

- ETAPA 32-35: INFRAESTRUTURA MULTI-INST√ÇNCIA (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-instances.sql
  - lib/oraculo-instances.ts
  - app/admin/oraculo-instances/page.tsx
  - app/admin/oraculo-instances/[id]/page.tsx
  - APIs de inst√¢ncias e m√©tricas
  - Build passou: 166 p√°ginas

- ETAPA 36: SISTEMA DE API KEYS (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-api-keys.sql
  - lib/oraculo-api-keys.ts
  - app/api/admin/oraculo-instances/[id]/keys/route.ts
  - Build passou: 166 p√°ginas

- ETAPA 37: SISTEMA DE WEBHOOKS (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-webhooks.sql
  - lib/oraculo-webhooks.ts
  - app/api/admin/oraculo-instances/[id]/webhooks/route.ts
  - Build passou: 166 p√°ginas

- ETAPA 38: SISTEMA DE BILLING (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-billing.sql
  - lib/oraculo-billing.ts
  - app/api/admin/oraculo-instances/[id]/billing/route.ts
  - Build passou: 166 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 20:30 ‚Üí 21:00):
- ETAPA 29: EXPOR OR√ÅCULO V2 PARA OUTROS PERFIS (‚úÖ CONCLU√çDO)
  - components/OraculoMultiperfil.tsx criado
  - components/OraculoHint.tsx criado
  - Build passou: 163 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 20:00 ‚Üí 20:30):
- ETAPA 28: INFRA MULTIPERFIL (‚úÖ CONCLU√çDO)
  - database/migrate-oraculo-settings.sql criado
  - lib/oraculo-settings.ts criado (helpers)
  - /api/oraculo-v2 integrado com verifica√ß√£o de limites
  - Build passou: 163 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 19:30 ‚Üí 20:00):
- ETAPA 27: ORACULO_V2_CORE (‚úÖ CONCLU√çDO)
  - lib/oraculo-core.ts criado (n√∫cleo reutiliz√°vel)
  - app/api/oraculo-v2/route.ts refatorado para usar o core
  - docs/ORACULO-CORE.md criado (documenta√ß√£o t√©cnica)
  - Prompts por perfil: admin, usuaria, profissional, dev, whitelabel
  - Build passou: 163 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 18:30 ‚Üí 19:30):
- ETAPA 26: Template de Resumo + Checklist + Regras (‚úÖ CONCLU√çDO)
  - docs/FORMATO-RESUMO-ETAPAS.md atualizado (v2.0)
  - docs/CHECKLIST-RESUMO-IA.md criado
  - docs/PATCHES-ORACULO-COMPLETO.md criado (unifica todos os patches)
  - scripts/validar-resumo-ia.ts criado
  - BLOCO 26-30 INICIADO!

MUDAN√áAS ANTERIORES (01/12/2025 18:00 ‚Üí 18:30):
- ETAPA 25: QA T√©cnico + Checklist P√≥s-MVP (‚úÖ CONCLU√çDO)
  - CHECKLIST-POS-MVP.md criado na raiz
  - L√ÇMPADA-RADAR.txt atualizado com progresso
  - Build passou: 163 p√°ginas
  - üéâ BLOCO 21-25 CONCLU√çDO!

MUDAN√áAS ANTERIORES (01/12/2025 17:00 ‚Üí 18:00):
- ETAPA 24: Manuais & Links Internos (‚úÖ CONCLU√çDO)
  - Todos os 5 manuais atualizados com links internos
  - MANUAL-ADMIN: se√ß√£o Seguran√ßa & Observabilidade
  - MANUAL-USUARIA: tabela de links r√°pidos
  - MANUAL-PROFISSIONAL: links para documenta√ß√£o relacionada
  - MANUAL-DEV: tabela de APIs principais
  - MANUAL-WHITELABEL: links para outros manuais
  - Build passou: 163 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 16:00 ‚Üí 17:00):
- ETAPA 23: Seguran√ßa T√©cnica & Observabilidade (‚úÖ CONCLU√çDO)
  - lib/rate-limit.ts (rate limiting em mem√≥ria)
  - lib/logger.ts (logger estruturado JSON)
  - GET /api/health (healthcheck endpoint)
  - Rate limiting aplicado em /api/oraculo-v2
  - Build passou: 163 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 15:00 ‚Üí 16:00):
- ETAPA 22: Or√°culo V2 Integrado (‚úÖ CONCLU√çDO)
  - POST /api/oraculo-v2 criado
  - Tabela oraculo_logs (database/migrate-oraculo-logs.sql)
  - Componente OraculoButton.tsx
  - Bot√£o flutuante em /admin e /admin/oraculo
  - docs/ORACULO-V2-PROMPT.md com system prompt
  - Manuais atualizados (ADMIN, DEV)
  - Build passou: 162 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 14:00 ‚Üí 15:00):
- ETAPA 21: Billing S√≥lido & Add-ons (‚úÖ CONCLU√çDO)
  - Tabela user_addons criada (database/migrate-user-addons.sql)
  - Webhook Stripe atualizado para processar add-ons
  - APIs /api/addons e /api/addons/consume criadas
  - lib/user-addons.ts com fun√ß√µes helper
  - docs/ENV-VARIABLES.md com mapeamento de vari√°veis
  - Build passou: 161 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 13:30 ‚Üí 14:00):
- ETAPA 20: L√¢mpada Geral (‚úÖ CONCLU√çDO)
  - LAMPADA-RADAR.txt criado na raiz
  - 6 se√ß√µes: Bugs, Confus√µes, Decis√µes, Ideias, D√≠vidas T√©cnicas, Notas
  - 3 bugs conhecidos documentados
  - 5 d√≠vidas t√©cnicas mapeadas
  - 6 ideias para o futuro
  - M√©tricas de sa√∫de do projeto

üéâ BLOCO 14-20 CONCLU√çDO! MVP 1.0 PRONTO!

MUDAN√áAS ANTERIORES (01/12/2025 13:00 ‚Üí 13:30):
- ETAPA 19: Manuais (‚úÖ CONCLU√çDO)
  - docs/MANUAL-USUARIA.md - Guia completo para usu√°rias
  - docs/MANUAL-PROFISSIONAL.md - Guia para psic√≥logos/advogados
  - docs/MANUAL-ADMIN.md - Guia para administradores
  - docs/MANUAL-DEV.md - Guia para desenvolvedores
  - docs/MANUAL-WHITELABEL.md - Guia para parceiros white-label
  - Build passou: 159 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 12:30 ‚Üí 13:00):
- ETAPA 18: Limpeza Admin & Mapa do Sistema (‚úÖ CONCLU√çDO)
  - Or√°culo agora √© o PRIMEIRO item do menu (defaultOrder: 0)
  - Curadoria Central logo ap√≥s (defaultOrder: 2)
  - Termos Aceitos movido para o final (defaultOrder: 50)
  - √çcones adicionados ao AdminSidebar: CreditCard, Lightbulb, FileText, Layers, UserPlus, Skull, Network, TrendingUp, MessageCircle
  - Removida entrada duplicada de termos_aceitos no registry
  - Build passou: 159 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 12:00 ‚Üí 12:30):
- ETAPA 17: Limpeza/Unifica√ß√£o de Dashboards (‚úÖ CONCLU√çDO)
  - Mapeamento: /dashboard (principal), /dashboard-profissional (profissional)
  - Legados j√° redirecionam: /dashboard-v2, /dashboard-premium
  - Links atualizados em 9 arquivos:
    * /app, /login, /biblioteca, /espelho, /sala
    * /chat-premium, /seguranca-premium, /documentos-premium, /configuracoes-premium
  - Admin agora redireciona para /admin ap√≥s login
  - Build passou: 159 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 11:30 ‚Üí 12:00):
- ETAPA 16: Or√°culo V1 (‚úÖ CONCLU√çDO)
  - P√°gina /admin/oraculo criada
  - Responde 7 perguntas-chave do neg√≥cio:
    1. O produto est√° crescendo?
    2. As pessoas est√£o usando?
    3. Estamos ganhando dinheiro?
    4. O sistema est√° saud√°vel?
    5. H√° situa√ß√µes de emerg√™ncia?
    6. O que os beta testers est√£o dizendo?
    7. O que est√° acontecendo hoje?
  - Integra√ß√£o com tabelas: user_profiles, clarity_tests, journal_entries, beta_feedback, beta_events
  - Links para /admin/analytics, /admin/metricas, /admin/insights
  - Registrado em admin-features-registry.ts
  - Build passou: 159 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 11:00 ‚Üí 11:30):
- ETAPA 15: Beta com 5 Usu√°rias (‚úÖ CONCLU√çDO)
  - Migration 20241201_beta_testers.sql
    * Campo is_beta_tester, beta_joined_at, beta_group em user_profiles
    * Tabela beta_feedback para coleta de feedback
    * Tabela beta_events para observabilidade
  - API /api/beta/feedback (POST, GET)
  - API /api/beta/events (POST, GET)
  - Componente BetaFeedbackWidget (bot√£o flutuante)
  - Hook useBetaTracking para tracking de eventos
  - Build passou: 158 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 09:35 ‚Üí 11:00):
- ETAPA 14: Loja Simplificada (‚úÖ CONCLU√çDO)
  - API /api/stripe/addon-checkout (POST)
    * Checkout de pagamento √∫nico para add-ons
    * Suporta card, boleto, pix
    * Cria produtos din√¢micos se Price ID n√£o configurado
    * Metadata com userId, addonId, credits, validityDays
  - P√°gina /loja/sucesso
    * Confirma√ß√£o de compra com detalhes do add-on
    * Suspense boundary para SSR
  - Componente AddonsStore atualizado
    * Integra√ß√£o real com API de checkout
    * Redirect para login se n√£o autenticado
  - lib/addons-config.ts
    * Add-ons "Relat√≥rio Completo" e "Kit Seguran√ßa" marcados como popular
    * Campos stripePriceId adicionados
  - Build passou: 156 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 08:00 ‚Üí 09:35):
- CICLO RADAR 5 TXT executado para sincroniza√ß√£o
- Verifica√ß√£o de estrutura de c√≥digo real vs documenta√ß√£o
- Prepara√ß√£o para BLOCO 14-20 (Loja, Beta, Or√°culo, Limpeza, Manuais, L√¢mpada)
- Nenhuma altera√ß√£o de c√≥digo neste ciclo (apenas documenta√ß√£o)

MUDAN√áAS ANTERIORES (01/12/2025 03:30 ‚Üí 08:00):
- ETAPA 12.3: Exporta√ß√£o em Massa V1 (‚úÖ CONCLU√çDO)
  - Bot√£o "CSV" na p√°gina de relat√≥rio do cliente
  - Exporta dados autorizados (share_*) em formato CSV
  - Inclui aviso √©tico no arquivo exportado
- ETAPA 13: Infra White-label V1 (‚úÖ CONCLU√çDO)
  - Tabela professional_brand (migration criada)
  - API /api/professional/brand (GET, POST)
  - P√°gina /dashboard-profissional/marca
  - Campos: display_name, brand_color, logo_url, tagline
  - Preview em tempo real
- Build passou: 154 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 02:00 ‚Üí 03:30):
- ETAPA 12.1.2: Revoga√ß√£o de Acesso pelo Cliente (‚úÖ CONCLU√çDO)
- ETAPA 12.2: Relat√≥rio B√°sico por Cliente V1 (‚úÖ CONCLU√çDO)

MUDAN√áAS ANTERIORES (01/12/2025 01:15 ‚Üí 02:00):
- ETAPA 12.1.1: P√°gina de Aceite de Convite (‚úÖ CONCLU√çDO)
  - Nova rota: /aceitar-convite
    * Suporta ?codigo=XXXXXXXX na URL
    * Fluxo para usu√°rio n√£o logado: mostra op√ß√µes login/cadastro
    * Fluxo para usu√°rio logado: valida c√≥digo e mostra permiss√µes
  - API: /api/professional/invite/validate (POST)
    * Valida c√≥digo de convite
    * Retorna dados do profissional e permiss√µes sugeridas
  - API: /api/professional/invite/accept (POST)
    * Aceita convite e define permiss√µes
    * Atualiza client_id, status='active', share_*
  - Migration de corre√ß√£o: 20241201_fix_professional_clients_nullable.sql
    * Torna client_id nullable (necess√°rio para convites pendentes)
    * Ajusta constraint unique
    * Adiciona policy para valida√ß√£o p√∫blica de c√≥digos
  - UX/√âtica:
    * Aviso claro: "Radar N√ÉO substitui terapia/laudo"
    * Cliente escolhe o que compartilhar
    * Men√ß√£o √† possibilidade de revogar acesso
- Build passou: 150 p√°ginas

MUDAN√áAS ANTERIORES (01/12/2025 00:45 ‚Üí 01:15):
- ETAPA 12.1: Infra de Clientes Profissionais (‚úÖ CONCLU√çDO)

MUDAN√áAS ANTERIORES (01/12/2025 00:15 ‚Üí 00:45):
- ETAPA 12: Dashboard Profissional V1 (‚úÖ CONCLU√çDO)
  - Nova rota: /dashboard-profissional
  - Gating por plano, tela "√Årea Exclusiva", se√ß√µes b√°sicas

MUDAN√áAS ANTERIORES (30/11/2025 23:55 ‚Üí 01/12/2025 00:15):
- ETAPA 11.2: Ajustes finos do dashboard (‚úÖ CONCLU√çDO)

MUDAN√áAS ANTERIORES (30/11/2025 23:30 ‚Üí 23:55):
- ETAPA 11.1: Dashboard usu√°ria com trilha do her√≥i (‚úÖ CONCLU√çDO)
  - app/dashboard/page.tsx reorganizado em 5 se√ß√µes
  - Timeline horizontal dos 5 passos
  - Cards de m√≥dulos liberados/bloqueados por plano
  - Componente HeroModuleCard

MUDAN√áAS ANTERIORES (30/11/2025 22:10 ‚Üí 23:30):
- CICLO RADAR 5 TXT executado para sincroniza√ß√£o

MUDAN√áAS ANTERIORES (30/11/2025 21:45 ‚Üí 22:10):
- ETAPA 11: Redesenho do Dashboard do Usu√°rio - INFRA (‚úÖ CONCLU√çDO)
  - lib/plan-dashboard-modules.ts atualizado com heroStep e minPlanLevel
  - lib/dashboard-user-layout.ts criado (buildUserDashboardLayout, getWelcomeMessage, etc.)
  - Backup do dashboard: app/dashboard/page.BACKUP_ETAPA11.tsx
  - Trilha do her√≥i: 5 etapas (Entender, Registrar, Conversar, Proteger, Recursos)

MUDAN√áAS ANTERIORES (30/11/2025 21:20 ‚Üí 21:45):
- ETAPA 10: Infra de Planos, Fam√≠lias e M√≥dulos de Dashboard (‚úÖ CONCLU√çDO)
  - lib/plan-taxonomy.ts (PlanFamily, PLAN_TAXONOMY, fun√ß√µes auxiliares)
  - lib/plan-dashboard-modules.ts (DashboardModuleId, DASHBOARD_MODULES)
  - /admin/planos com SemaforoCard amarelo

MUDAN√áAS ANTERIORES (30/11/2025 20:50 ‚Üí 21:20):
- ETAPA 9: Painel de Curadoria + Sem√°foro de Edi√ß√£o (‚úÖ CONCLU√çDO)
  - lib/curadoria-config.ts (get/update config)
  - /api/admin/curadoria/config (GET/PATCH)
  - components/admin/EditSemaforoBadge.tsx
  - /admin/curadoria (painel central)
  - Sem√°foro aplicado em 4 p√°ginas admin

MUDAN√áAS ANTERIORES (30/11/2025 20:20 ‚Üí 20:50):
- ETAPA 8.4: FanPage Viva (‚úÖ CONCLU√çDO)
  - 5 componentes em components/frontpage/
  - lib/frontpage-content.ts + API /api/frontpage/content
  - app/page.tsx integrado com DynamicSections

MUDAN√áAS ANTERIORES (30/11/2025 19:50 ‚Üí 20:20):
- ETAPA 8.3: Telas Admin de Curadoria (‚úÖ CONCLU√çDO)
  - 4 p√°ginas criadas: sugestoes, publicados, colecoes, insights
  - admin-features-registry.ts atualizado

MUDAN√áAS ANTERIORES (30/11/2025 17:50 ‚Üí 19:50):
- ETAPA 8.1: Schema do Content System (6 tabelas criadas)
- ETAPA 8.2: 9 APIs Admin + IA Curadora implementadas

MUDAN√áAS ANTERIORES (30/11/2025 16:45 ‚Üí 17:50):
- ETAPA 7.4: QA Tri√¢ngulo + Plano de Seguran√ßa (todos testes PASS)
- Prepara√ß√£o para ETAPA 8: FanPage Viva + Camada Comercial
- Ciclo RADAR 5 TXT executado para sincroniza√ß√£o

MUDAN√áAS ANTERIORES (30/11/2025 15:20 ‚Üí 16:45):
- ETAPA 7.4: QA completo (T1-T5 PASS)
- Verifica√ß√£o de seguran√ßa/RLS em todas APIs
- Documenta√ß√£o atualizada

MUDAN√áAS ANTERIORES (30/11/2025 11:30 ‚Üí 15:20):
- ETAPA 7.3: Plano de Seguran√ßa integrado ao Tri√¢ngulo
- API REST /api/safety-plan criada (GET, POST, PATCH)
- Card "Plano de Seguran√ßa" no Dashboard com status colorido
- Banner de alerta de risco f√≠sico no Dashboard
- Detec√ß√£o de risco f√≠sico no Chat via regex (PHYSICAL_RISK_REGEX)
- Banner de alerta no Chat quando risco f√≠sico detectado
- Cria√ß√£o autom√°tica de risk_alert via Chat
- Badge üõ°Ô∏è "Plano de Seguran√ßa" no Di√°rio e Timeline
- Tipo 'safety_plan' adicionado ao JournalEntryType
- risk_alert autom√°tico quando hasPhysicalRisk no Teste de Clareza
- Build passou: 134 p√°ginas

MUDAN√áAS ANTERIORES (30/11/2025 09:20 ‚Üí 11:30):
- ETAPA 6: Tri√¢ngulo V2 (Filtros + Mapa no Dashboard)
- Filtros por entry_type no /diario (clarity_baseline, chat_summary, normal)
- Filtros por entry_type no /diario/timeline
- Legenda do Tri√¢ngulo na Timeline (‚ú®, üí¨, üî•)
- Card "Estado do Tri√¢ngulo" no /dashboard com 3 colunas
- Status "Tri√¢ngulo Ativo" ou "Incompleto" no Dashboard

MUDAN√áAS ANTERIORES (30/11/2025 01:00 ‚Üí 09:20):
- ETAPA 2: Tri√¢ngulo Clareza ‚áÑ Di√°rio ‚áÑ Chat implementado
- ETAPA 3: Di√°rio/Timeline/Dashboard conectados ao tri√¢ngulo
- ETAPA 4: Chat ‚Üí Di√°rio (salvar resumo de sess√£o)
- ETAPA 5: Editor Visual da Frontpage (sem c√≥digo)
- Badges "Perfil de Clareza", "Intenso" e "Resumo do Chat" no Di√°rio/Timeline
- Dashboard confirmado consumindo dados reais
- Tipos JournalEntryType adicionados em types/database.ts
- Tabela frontpage_config para edi√ß√£o din√¢mica da frontpage
- Hook useFrontpageConfig.ts criado para consumir configs
- Build passou: 133 p√°ginas (antes 130)

FERRAMENTAS FUTURAS (GUARDADAS NA MEM√ìRIA):
- Dashboard: Tremor (React nativo)
- Seguran√ßa: Arcjet + Supabase RLS
- Chatbot Frontpage: Crisp ou Tawk.to
- WhatsApp Bot: Typebot + Z-API
- Suporte/Helpdesk: Crisp

================================================================================
[√çNDICE]
================================================================================
1. Vis√£o geral do projeto
2. Rotas e p√°ginas (app/)
3. Fluxos principais
   3.1 Teste de Clareza
   3.2 Di√°rio
   3.3 Chat/Coach IA
   3.4 Dashboard
   3.5 Editor Visual da Frontpage
4. Esquema de banco (Supabase)
5. Planos e monetiza√ß√£o
6. Idiomas (i18n)
7. Seguran√ßa, LGPD e bot√£o de emerg√™ncia
8. Diferen√ßa entre vis√£o (TUDO PARA O GPT.txt) e c√≥digo real
9. Pend√™ncias t√©cnicas e riscos
10. Sistema de Limites por Plano
11. Sistema de Planos Administr√°veis
12. Corre√ß√µes de Acesso Admin
13. Arquivos de Mem√≥ria do Projeto
14. Editor Visual da Frontpage
15. Tri√¢ngulo V2 (Filtros + Mapa no Dashboard)
16. Fluxo de Convite Profissional/Cliente

================================================================================
[1] VIS√ÉO GERAL DO PROJETO
================================================================================

STACK T√âCNICA:
- Framework: Next.js 16.0.3 (App Router)
- Linguagem: TypeScript 5.x
- React: 19.2.0
- Estiliza√ß√£o: TailwindCSS 4.0.0
- Banco de dados: Supabase (PostgreSQL + Auth + Storage)
- Pagamentos: Stripe 20.0.0
- IAs: OpenAI 6.9.1 + Groq (via lib/ia-conexoes-reais.ts)
- PDF: jspdf 3.0.4 + @react-pdf/renderer 4.3.1
- Gr√°ficos: Recharts 3.5.0
- Anima√ß√µes: Framer Motion 12.23.24

PASTAS PRINCIPAIS:
- app/           ‚Üí Rotas e p√°ginas (App Router do Next.js)
- lib/           ‚Üí L√≥gica de neg√≥cio, configs, prompts, utils
- components/    ‚Üí Componentes React reutiliz√°veis
- hooks/         ‚Üí Hooks customizados:
                   - useClarityProfile.ts (perfil de clareza do usu√°rio)
                   - useFrontpageConfig.ts (configs edit√°veis da frontpage)
                   - useI18n.ts (internacionaliza√ß√£o)
                   - usePlanLimits.ts (limites por plano)
                   - usePlans.ts (lista de planos)
                   - useUserRole.ts (role do usu√°rio)
- database/      ‚Üí Schemas SQL e migrations
- public/        ‚Üí Assets est√°ticos
- scripts/       ‚Üí Scripts de build e verifica√ß√£o

√ÅREAS PRINCIPAIS DO SISTEMA:
1. Teste de Clareza (18 perguntas + 1 aberta, 3 eixos, 6 categorias)
2. Di√°rio de Epis√≥dios (registros com tags, anexos, an√°lise IA)
3. Chat/Coach IA (m√∫ltiplas IAs colaborativas)
4. Dashboard (vis√£o geral, alertas, recomenda√ß√µes)
5. Planos (Visitante, Guardar, Jornada, Defesa, Profissional)
6. Admin (painel administrativo completo)
7. Hub de Problemas (invalida√ß√£o, gaslighting, etc.)
8. Plano de Seguran√ßa (contatos, documentos, mala de emerg√™ncia)
9. Loja de Add-ons (funcionalidades extras)
10. Blog/Educa√ß√£o (conte√∫do sobre abuso narcisista)

================================================================================
[2] ROTAS E P√ÅGINAS (app/)
================================================================================

ROTAS PRINCIPAIS (verificadas no c√≥digo):

/ (Homepage)
  Arquivo: app/page.tsx (97KB)
  Fun√ß√£o: Landing page com hero, se√ß√µes de confian√ßa, "Como Funciona",
          bloco "Voc√™ escolhe como usar", ferramentas, planos, FAQ.
  Status: IMPLEMENTADA com i18n (PT/EN/ES)

/teste-clareza
  Arquivo: app/teste-clareza/page.tsx (47KB)
  Fun√ß√£o: Teste de Clareza com 18 perguntas objetivas + 1 aberta.
          Usa lib/clarity-unified-config.ts para configura√ß√£o.
  Status: IMPLEMENTADA

/teste-clareza/resultado
  Arquivo: app/teste-clareza/resultado/page.tsx
  Fun√ß√£o: Exibe resultado do teste com zonas, eixos, categorias,
          op√ß√£o de salvar como "base do Radar" ou apenas visualizar.
  Status: IMPLEMENTADA

/planos
  Arquivo: app/planos/page.tsx (15KB)
  Fun√ß√£o: P√°gina de planos com toggle mensal/anual.
          Usa lib/plans-config.ts para configura√ß√£o.
  Status: IMPLEMENTADA

/diario
  Arquivo: app/diario/page.tsx (17KB)
  Fun√ß√£o: Lista de entradas do di√°rio com filtros e busca.
  Status: IMPLEMENTADA

/diario/novo
  Arquivo: app/diario/novo/page.tsx
  Fun√ß√£o: Criar nova entrada no di√°rio com tags, anexos, an√°lise IA.
  Status: IMPLEMENTADA

/diario/[id]
  Arquivo: app/diario/[id]/page.tsx
  Fun√ß√£o: Visualizar entrada espec√≠fica do di√°rio.
  Status: IMPLEMENTADA

/diario/timeline
  Arquivo: app/diario/timeline/page.tsx
  Fun√ß√£o: Timeline visual dos epis√≥dios registrados.
  Status: IMPLEMENTADA

/chat
  Arquivo: app/chat/page.tsx (89KB)
  Fun√ß√£o: Chat com Coach IA de Clareza. Usa m√∫ltiplas IAs (OpenAI + Groq).
          Recebe contexto do perfil de clareza do usu√°rio.
  Status: IMPLEMENTADA

/dashboard
  Arquivo: app/dashboard/page.tsx
  Fun√ß√£o: Vis√£o geral do usu√°rio com recomenda√ß√µes e alertas.
  Status: IMPLEMENTADA

/plano-seguranca
  Arquivo: app/plano-seguranca/page.tsx
  Fun√ß√£o: Plano de seguran√ßa com contatos, documentos, mala de emerg√™ncia.
  Status: IMPLEMENTADA

/profissional
  Arquivo: app/profissional/page.tsx
  Fun√ß√£o: P√°gina para profissionais (terapeutas, advogados).
  Status: IMPLEMENTADA (com waitlist)

/loja
  Arquivo: app/loja/page.tsx
  Fun√ß√£o: Loja de add-ons e funcionalidades extras.
  Status: IMPLEMENTADA

/hub
  Arquivo: app/hub/page.tsx
  Fun√ß√£o: Hub de problemas (invalida√ß√£o, gaslighting, etc.).
  Status: IMPLEMENTADA

/admin/*
  Arquivos: app/admin/ (37 subpastas)
  Fun√ß√£o: Painel administrativo completo com:
          - Analytics, m√©tricas, custos IA
          - Gerenciamento de IAs, fluxos
          - Beta testers, comunidade
          - Configura√ß√µes, estados
          - Editor de Frontpage (formul√°rios e visual)
          - Gerenciamento de planos e promo√ß√µes
  Status: IMPLEMENTADA
  
  Rotas Admin Principais:
  - /admin/planos ‚Üí CRUD de planos e promo√ß√µes
  - /admin/frontpage-editor ‚Üí Editor por formul√°rios
  - /admin/frontpage-visual ‚Üí Editor visual com preview
  - /admin/usuarios ‚Üí Gerenciamento de usu√°rios
  - /admin/custos-ia ‚Üí Monitoramento de custos
  - /admin/fluxos-ia ‚Üí Fluxos de IA configur√°veis
  - /admin/mapa-ias ‚Üí Mapa de IAs do sistema
  - /admin/analytics ‚Üí Analytics gerais

OUTRAS ROTAS RELEVANTES:
- /login, /cadastro ‚Üí Autentica√ß√£o
- /configuracoes ‚Üí Configura√ß√µes do usu√°rio
- /privacidade, /termos ‚Üí P√°ginas legais
- /blog ‚Üí Conte√∫do educativo
- /faq ‚Üí Perguntas frequentes
- /contato ‚Üí Formul√°rio de contato
- /seguranca, /seguranca-digital ‚Üí Recursos de seguran√ßa
- /modo-espelho, /espelho ‚Üí Ferramenta de reflex√£o
- /carta-futuro ‚Üí Cartas para o futuro
- /termometro ‚Üí Term√¥metro emocional
- /ciclo-abuso, /gaslighting, /love-bombing, /triangulacao ‚Üí Educa√ß√£o

================================================================================
[3] FLUXOS PRINCIPAIS
================================================================================

--------------------------------------------------------------------------------
[3.1] TESTE DE CLAREZA
--------------------------------------------------------------------------------

ARQUIVO DE CONFIGURA√á√ÉO PRINCIPAL:
lib/clarity-unified-config.ts (21KB)

ESTRUTURA DO TESTE:
- 18 perguntas objetivas (escala 0-4: Nunca ‚Üí Quase sempre)
- 1 pergunta aberta (narrativa do usu√°rio)
- Pesos diferentes por pergunta (1, 1.5, 2, 2.5, 3)

3 EIXOS PRINCIPAIS:
1. N√©voa Mental (nevoa) - Confus√£o, gaslighting, d√∫vida
2. Medo e Tens√£o (medo) - Medo de rea√ß√µes, tens√£o constante
3. Desrespeito a Limites (limites) - Limites ignorados, isolamento

6 CATEGORIAS DETALHADAS:
1. Invalida√ß√£o (3 perguntas) - Eixo: N√©voa
2. Gaslighting (3 perguntas) - Eixo: N√©voa
3. Controle (3 perguntas) - Eixo: Medo
4. Isolamento (3 perguntas) - Eixo: Limites
5. Abuso Emocional (3 perguntas) - Eixo: Medo
6. Risco F√≠sico (3 perguntas) - Eixo: Limites (peso alto)

ZONAS GLOBAIS:
- Zona de Aten√ß√£o (0-33%): Sinais leves
- Zona de Alerta (33-66%): Sinais moderados
- Zona de Alto Risco (66-100%): Sinais graves

ARQUIVO DE VOZES:
lib/clarity-questions-voices.ts (11KB)
- 3 vozes: Cient√≠fica, Amiga, Direta
- Cada pergunta tem texto adaptado para cada voz

FLUXO "GUARDAR X VER APENAS":
- Visitante: Faz teste, v√™ resultado, n√£o salva
- Logado: Pode escolher "Guardar como base do Radar"
- API: app/api/clarity/activate-profile/route.ts
- Quando salva: is_profile_base = true, gera resumo IA

RESUMO AUTOM√ÅTICO POR IA:
- Fun√ß√£o: generateAISummary() em activate-profile/route.ts
- Usa provedores: Groq > OpenAI > Claude > Gemini
- Gera 3-5 frases emp√°ticas sem diagn√≥stico
- Salvo no campo `summary` da tabela clarity_tests

--------------------------------------------------------------------------------
[3.2] DI√ÅRIO (UNIFICADO EM 29/11/2025)
--------------------------------------------------------------------------------

ROTAS OFICIAIS:
- /diario ‚Üí Lista de entradas (fonte de verdade dos epis√≥dios)
- /diario/novo ‚Üí Criar entrada com tags, anexos, an√°lise IA
- /diario/[id] ‚Üí Visualizar entrada espec√≠fica
- /diario/[id]/editar ‚Üí Editar entrada espec√≠fica
- /diario/timeline ‚Üí Timeline de Padr√µes (estat√≠sticas, problemas detectados)

ROTAS ARQUIVADAS (em app/_archive/):
- /diario-premium ‚Üí Vers√£o experimental com design premium (ARQUIVADA)
- /timeline-premium ‚Üí Duplicata da timeline (ARQUIVADA)
- /linha-tempo ‚Üí Timeline de fases do ciclo de abuso (ARQUIVADA - ser√° V2)

REGRA DE OURO:
"O Di√°rio √© a fonte de verdade dos epis√≥dios. A Timeline de Padr√µes s√≥ l√™/analisa
o que est√° em journal_entries + tags + clareza."

TABELA: journal_entries
- id, user_id, created_at, updated_at, deleted_at
- title, context (RELACIONAMENTO/FAMILIA/TRABALHO/OUTRO)
- content, mood_intensity (0-10), highlight, tags[]
- from_voice (se veio de transcri√ß√£o)
- entry_type (normal, clarity_baseline) - NOVO
- clarity_test_id (refer√™ncia ao teste) - NOVO

INTEGRA√á√ÉO COM TESTE DE CLAREZA (ETAPA 2 - TRI√ÇNGULO):
- Quando usu√°rio salva teste como base, CRIA entrada autom√°tica no di√°rio
- entry_type = 'clarity_baseline'
- clarity_test_id = ID do teste
- Tags sugeridas baseadas nos eixos do teste (gaslighting, medo, controle, etc.)
- T√≠tulo: "üìä Radiografia da Rela√ß√£o ‚Äì [Zona]"
- Implementado em: app/api/clarity/activate-profile/route.ts
- NOVO (ETAPA 7.3): Se hasPhysicalRisk = true, cria risk_alert autom√°tico

INTEGRA√á√ÉO COM PLANO DE SEGURAN√áA (ETAPA 7.3 - TRI√ÇNGULO):
- Quando usu√°rio cria/atualiza Plano de Seguran√ßa, CRIA entrada no di√°rio
- entry_type = 'safety_plan'
- Tags: ['seguranca', 'plano']
- T√≠tulo: "Plano de Seguran√ßa criado/atualizado"
- Implementado em: app/api/safety-plan/route.ts

INTEGRA√á√ÉO COM CHAT (ETAPA 2 - TRI√ÇNGULO):
- Chat recebe contexto dos √∫ltimos 3 epis√≥dios mais intensos (30 dias)
- Chat recebe perfil de clareza do usu√°rio
- Implementado em: app/api/chat/route.ts (getDiaryContextForChat)

INTEGRA√á√ÉO COM NOVA ENTRADA (ETAPA 2 - TRI√ÇNGULO):
- /diario/novo aceita query string: ?from=clarity_result&clarity_test_id=UUID
- Pr√©-preenche t√≠tulo, tags, impacto e descri√ß√£o baseado no perfil de clareza
- Salva entry_type e clarity_test_id no insert
- Implementado em: app/diario/novo/page.tsx

ANEXOS:
- Tabela: journal_attachments
- Tipos: IMAGE, AUDIO, PDF, VIDEO, OTHER
- Storage: Supabase Storage

--------------------------------------------------------------------------------
[3.3] CHAT/COACH IA
--------------------------------------------------------------------------------

ROTA: /chat
ARQUIVO: app/chat/page.tsx (89KB)

SISTEMA DE IAs:
- lib/chat-colaborativo.ts - Sistema de m√∫ltiplas IAs
- lib/ia-conexoes-reais.ts - Conex√µes com OpenAI e Groq
- lib/prompts/coachPrompt.ts - Prompt do Coach de Clareza

PROMPT DO COACH:
- Persona: "Radar Narcisista ‚Äì Coach de Clareza"
- Tom: Amigo respons√°vel brasileiro
- Regras: Responder diretamente, sugerir passos, poucas perguntas
- Limites: N√£o √© terapia, n√£o faz diagn√≥stico
- Protocolo de crise: CVV 188, Pol√≠cia 190, Mulher 180
- Guardrails anti-vingan√ßa: Detecta e recusa ajudar com vingan√ßa
- Detec√ß√£o de fraude: Red flags para relatos inconsistentes

INTEGRA√á√ÉO COM PERFIL DE CLAREZA:
- Busca perfil do usu√°rio (is_profile_base = true)
- Injeta contexto silencioso com:
  - Zona atual, percentual geral
  - Scores dos 3 eixos
  - Alerta de risco f√≠sico (se houver)
  - Resumo gerado pela IA
- IA usa contexto para personalizar respostas

API: /api/chat
- Recebe: message, history, userLocation, clarityProfile
- Detecta problemas no texto (gaslighting, invalida√ß√£o, etc.)
- Detecta red flags de fraude/m√°-f√©
- Retorna: reply, transparencia (IAs usadas, consenso)

API: /api/chat/save-summary (ETAPA 4 - CHAT ‚Üí DI√ÅRIO)
- Recebe: summaryText (obrigat√≥rio, min 10 chars), moodIntensity (0-10), tags[]
- Cria entrada em journal_entries com entry_type = 'chat_summary'
- T√≠tulo autom√°tico: "üí¨ Resumo da sess√£o com o Coach ‚Äì DD/MM/YYYY"
- Requer autentica√ß√£o

DETEC√á√ÉO DE RISCO F√çSICO (ETAPA 7.3 - PLANO DE SEGURAN√áA):
- Regex PHYSICAL_RISK_REGEX detecta frases de risco f√≠sico em mensagens
- Palavras-chave: "me bateu", "me agrediu", "amea√ßou", "vai me matar", "medo de morrer", etc.
- Quando detecta: showPhysicalRiskAlert = true, exibe banner vermelho
- Cria risk_alert via POST /api/chat com createRiskAlert = true
- risk_alert salvo com: source='chat', level='HIGH', category='PHYSICAL_VIOLENCE'
- Banner inclui link para /plano-seguranca
- Implementado em: app/chat/page.tsx + app/api/chat/route.ts

UI DO CHAT (ETAPA 4 + 7.3):
- Bot√£o "Salvar no Di√°rio" aparece ap√≥s 2+ mensagens do usu√°rio
- Modal de resumo: textarea, slider de intensidade, tags edit√°veis
- Modal de encerramento: checkbox para salvar resumo antes de encerrar
- Badge "Resumo do Chat" (üí¨) exibido no Di√°rio e Timeline
- NOVO: Banner de alerta de risco f√≠sico (vermelho) quando detectado

--------------------------------------------------------------------------------
[3.4] DASHBOARD (ETAPA 3 - VISOR DO TRI√ÇNGULO)
--------------------------------------------------------------------------------

ROTA: /dashboard
ARQUIVO: app/dashboard/page.tsx

CONTE√öDO:
- Resumo do perfil de clareza (se existir) - usa hook useClarityProfile
- √öltimas entradas do di√°rio - l√™ journal_entries reais
- Alertas de risco (se houver)
- Recomenda√ß√µes personalizadas baseadas no perfil
- Atalhos para ferramentas
- Estat√≠sticas reais: testes, epis√≥dios, mensagens, dias ativos
- NOVO (ETAPA 7.3): Card "Plano de Seguran√ßa" com status colorido
- NOVO (ETAPA 7.3): Banner de alerta de risco f√≠sico

CARD "PLANO DE SEGURAN√áA" (ETAPA 7.3):
- Busca status via GET /api/safety-plan
- Status: NOT_STARTED (cinza), IN_PROGRESS (amarelo), READY (verde)
- √çcone Shield, link para /plano-seguranca
- Mostra contagem de contatos de emerg√™ncia

BANNER DE RISCO F√çSICO (ETAPA 7.3):
- Aparece se hasPhysicalRisk = true no perfil de clareza
- E se safetyPlanStatus !== 'READY'
- Cor varia: vermelho (NOT_STARTED), amarelo (IN_PROGRESS)
- Mensagem incentiva completar o Plano de Seguran√ßa
- Link direto para /plano-seguranca

FONTES DE DADOS REAIS:
- clarity_tests (perfil base)
- journal_entries (incluindo clarity_baseline, chat_summary, safety_plan)
- ai_messages (hist√≥rico de chat)
- safety_plans (plano de seguran√ßa)
- risk_alerts (alertas de risco)

VARIANTES:
- /dashboard-v2 ‚Üí Vers√£o alternativa
- /dashboard-premium ‚Üí Vers√£o para planos pagos

================================================================================
[4] ESQUEMA DE BANCO (SUPABASE)
================================================================================

ARQUIVO: database/schema.sql (20KB)

TABELAS PRINCIPAIS:

user_profiles
- user_id (PK, FK ‚Üí auth.users)
- name, role (USER/ADMIN/SUPER_ADMIN)
- created_at, updated_at

user_settings
- user_id (PK, FK ‚Üí auth.users)
- save_history, save_voice_audio
- allow_ai_learning_product, allow_ai_dataset_research
- created_at, updated_at

clarity_tests
- id (PK), user_id (FK)
- fog_score, fear_score, limits_score (0-16 cada)
- global_zone (ATENCAO/ALERTA/VERMELHA)
- raw_answers (JSONB), summary (TEXT)
- from_voice (BOOLEAN)
- NOVOS CAMPOS (migrations pendentes):
  - is_profile_base (BOOLEAN)
  - user_narrative (TEXT)
  - overall_percentage (DECIMAL)
  - has_physical_risk (BOOLEAN)
  - test_type (TEXT)
  - category_scores (JSONB)
  - axis_scores (JSONB)
  - ip_hash (TEXT)
  - completed_at (TIMESTAMPTZ)

journal_entries
- id (PK), user_id (FK)
- title, context, content
- mood_intensity, highlight, tags[]
- from_voice, deleted_at
- CAMPOS DE INTEGRA√á√ÉO (ETAPA 2/3 - TRI√ÇNGULO):
  - entry_type (TEXT, default 'normal') - tipos: normal, clarity_baseline, chat_summary
  - clarity_test_id (UUID, FK ‚Üí clarity_tests) - refer√™ncia ao teste de clareza
  - Migration: database/migrations/20241129_add_diary_clarity_fields.sql

journal_attachments
- id (PK), journal_entry_id (FK), user_id (FK)
- type, filename, storage_path
- description, transcription

ai_chat_sessions
- id (PK), user_id (FK)
- name, kind (USER_COACH, AI_STUDIO_*)

ai_messages
- id (PK), session_id (FK), user_id (FK)
- role (user/assistant/system/meta)
- content, from_voice, meta (JSONB)

subscriptions
- id (PK), user_id (FK)
- stripe_subscription_id, stripe_customer_id
- status, price_id, amount, currency
- current_period_start/end, cancel_at_period_end

safety_plans
- id (PK), user_id (FK)
- emergency_contacts (JSONB)
- important_documents (JSONB)
- emergency_bag_items (JSONB)
- safe_place (JSONB)
- digital_security (JSONB)
- overall_status, notes

risk_alerts
- id (PK), user_id (FK)
- source, source_id, level, category
- title, description, recommendation
- is_read, is_dismissed

waitlist (NOVA - migration pendente)
- id (PK), email, source
- created_at, notified_at, converted_at
- metadata (JSONB)

MIGRATIONS PENDENTES (database/migrations/):
1. 20241129_add_clarity_profile_base.sql
2. 20241129_add_clarity_extra_fields.sql
3. 20241129_add_diary_clarity_fields.sql
4. 20241129_create_waitlist.sql

RLS (Row Level Security):
- Todas as tabelas t√™m RLS habilitado
- Pol√≠ticas: usu√°rio s√≥ v√™/edita seus pr√≥prios dados
- Admins t√™m acesso especial via role

================================================================================
[5] PLANOS E MONETIZA√á√ÉO
================================================================================

ARQUIVO: lib/plans-config.ts (11KB)

5 N√çVEIS DE PLANO:

1. VISITANTE (sem conta)
   - legacyId: 'visitante'
   - Pre√ßo: Gr√°tis
   - Limites: 1 teste/m√™s, 0 di√°rio, 0 chat
   - Features: Teste 1x, ver resultado na tela
   - N√ÉO inclui: PDF, salvar, di√°rio, coach

2. RADAR GUARDAR (gratuito com conta)
   - legacyId: 'gratuito'
   - Pre√ßo: Gr√°tis
   - Limites: Testes ilimitados, 3 di√°rio/m√™s, 5 chat/dia
   - Features: Salvar resultado, di√°rio b√°sico, coach b√°sico
   - N√ÉO inclui: PDF, hist√≥rico completo

3. RADAR JORNADA (ex-Essencial)
   - legacyId: 'essencial'
   - Pre√ßo: R$29,90/m√™s ou R$299/ano
   - Limites: Ilimitado di√°rio, 50 chat/dia
   - Features: Tudo do Guardar + PDF, hist√≥rico, an√°lise padr√µes

4. RADAR DEFESA (ex-Premium)
   - legacyId: 'premium'
   - Pre√ßo: R$49,90/m√™s ou R$499/ano
   - Limites: Ilimitado tudo
   - Features: Tudo do Jornada + IAs colaborativas, relat√≥rios avan√ßados
   - popular: true

5. RADAR PROFISSIONAL (futuro)
   - legacyId: 'profissional'
   - Pre√ßo: R$99,90/m√™s
   - comingSoon: true
   - Para: Terapeutas, advogados
   - Features: M√∫ltiplos clientes, relat√≥rios profissionais

INTEGRA√á√ÉO STRIPE:
- Arquivo: lib/stripe.ts
- API: app/api/stripe/checkout, webhook, portal
- Price IDs: via env (STRIPE_PRICE_ESSENCIAL_MENSAL, etc.)

================================================================================
[6] IDIOMAS (i18n)
================================================================================

ARQUIVO: lib/i18n.ts (36KB)

IDIOMAS SUPORTADOS:
- pt-BR (Portugu√™s Brasileiro) - DEFAULT
- en (English)
- es (Espa√±ol)

ESTRUTURA:
- translations: Record<Locale, Record<string, string>>
- frontpageDictionaries: Dicion√°rios estruturados para homepage

P√ÅGINAS COM i18n IMPLEMENTADO:
- app/page.tsx (homepage) - PARCIAL
  - Se√ß√µes: Hero, Como Funciona, Ferramentas, Planos, Garantias
  - Bloco "Voc√™ escolhe como usar"
  - Algumas listas ainda hardcoded em PT-BR

P√ÅGINAS SEM i18n (hardcoded PT-BR):
- app/teste-clareza/page.tsx
- app/diario/*.tsx
- app/chat/page.tsx
- app/dashboard/page.tsx
- app/planos/page.tsx
- Maioria das outras p√°ginas

COMPONENTE SELETOR:
- components/LanguageSelector.tsx
- Salva prefer√™ncia no localStorage
- Recarrega p√°gina ao mudar idioma

================================================================================
[7] SEGURAN√áA, LGPD E BOT√ÉO DE EMERG√äNCIA
================================================================================

BOT√ÉO DE EMERG√äNCIA (ESC):
- Implementado em: components/EmergencyButton.tsx
- Atalho: Tecla ESC
- A√ß√£o: Redireciona para site neutro (Google)
- Presente em: Layout principal, p√°ginas sens√≠veis

TERMOS E RESPONSABILIDADE:
- Componente: components/ResponsibilityTermsModal.tsx
- Modal obrigat√≥rio no primeiro uso do chat
- 6 checkboxes obrigat√≥rios:
  1. Perspectiva unilateral
  2. Mentir √© crime (Art. 299 CP)
  3. Forjar provas √© crime (Art. 347 CP)
  4. Cal√∫nia/difama√ß√£o/inj√∫ria s√£o crimes
  5. Responsabilidade total pelo uso
  6. Ferramenta de apoio (n√£o substitui profissionais)
- Registra aceite no banco com timestamp

AVISOS NO FRONTEND:
- Chat: Microaviso abaixo do input
- Chat: Aviso peri√≥dico a cada 8 mensagens
- Chat: Modal de confirma√ß√£o antes de exportar PDF
- Di√°rio: Microaviso abaixo do campo de descri√ß√£o
- Timeline: Aviso completo com √≠cone

LGPD:
- Tabela user_settings com prefer√™ncias de privacidade
- save_history, save_voice_audio
- allow_ai_learning_product, allow_ai_dataset_research
- Rota /configuracoes para gerenciar prefer√™ncias
- Rota /privacidade com pol√≠tica de privacidade

EXPORTAR/APAGAR DADOS:
- Rota /dados-e-ia para visualizar dados
- Funcionalidade de exportar dados: PARCIALMENTE IMPLEMENTADA
- Funcionalidade de apagar conta: PARCIALMENTE IMPLEMENTADA

================================================================================
[8] DIFEREN√áA ENTRE VIS√ÉO (TUDO PARA O GPT.txt) E C√ìDIGO REAL
================================================================================

TESTE DE CLAREZA:
- Vis√£o: 18 perguntas + 1 aberta, 3 eixos, 6 categorias, vozes
- C√≥digo: ‚úÖ IMPLEMENTADO CONFORME VIS√ÉO
- Diferen√ßa: Nenhuma significativa

FLUXO "GUARDAR X VER APENAS":
- Vis√£o: Escolha clara entre ver e guardar como base
- C√≥digo: ‚úÖ IMPLEMENTADO
- API activate-profile funcional
- Resumo IA gerado automaticamente

DI√ÅRIO:
- Vis√£o: Integra√ß√£o com teste de clareza, tags sugeridas
- C√≥digo: ‚úÖ IMPLEMENTADO
- Campos entry_type e clarity_test_id adicionados
- PENDENTE: Migrations precisam ser executadas no Supabase

CHAT/COACH IA:
- Vis√£o: M√∫ltiplas IAs, contexto do perfil, detec√ß√£o de fraude
- C√≥digo: ‚úÖ IMPLEMENTADO
- Sistema colaborativo OpenAI + Groq
- Contexto do perfil de clareza injetado
- Detec√ß√£o de red flags funcionando

PLANOS:
- Vis√£o: 5 n√≠veis (Visitante, Guardar, Jornada, Defesa, Profissional)
- C√≥digo: ‚úÖ IMPLEMENTADO
- Nomes comerciais corretos
- legacyId mantido para Stripe
- Profissional marcado como comingSoon

IDIOMAS:
- Vis√£o: PT/EN/ES em toda a plataforma
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- Homepage tem i18n
- Maioria das outras p√°ginas ainda hardcoded PT-BR

RADAR PROFISSIONAL:
- Vis√£o: Plano B2B para terapeutas/advogados
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /profissional existe com waitlist
- Funcionalidades espec√≠ficas: AINDA N√ÉO IMPLEMENTADAS

LOJA DE ADD-ONS:
- Vis√£o: Funcionalidades extras para compra avulsa
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /loja existe
- Integra√ß√£o com pagamento: AINDA N√ÉO IMPLEMENTADA

TRILHAS/CURSOS:
- Vis√£o: Conte√∫do educativo personalizado
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /cursos existe
- Personaliza√ß√£o baseada no teste: AINDA N√ÉO IMPLEMENTADA

================================================================================
[9] PEND√äNCIAS T√âCNICAS E RISCOS
================================================================================

MIGRATIONS PENDENTES (CR√çTICO):
Os seguintes arquivos SQL existem mas podem n√£o ter sido executados:
1. database/migrations/20241129_add_clarity_profile_base.sql
   - Adiciona: is_profile_base, user_narrative, overall_percentage, etc.
2. database/migrations/20241129_add_clarity_extra_fields.sql
   - Adiciona: category_scores, axis_scores, ip_hash, summary, completed_at
3. database/migrations/20241129_add_diary_clarity_fields.sql
   - Adiciona: entry_type, clarity_test_id em journal_entries
4. database/migrations/20241129_create_waitlist.sql
   - Cria tabela waitlist com RLS

RISCO: Se as migrations n√£o forem executadas, o c√≥digo que usa esses campos
vai falhar silenciosamente ou com erro.

ARQUIVOS DE BACKUP:
- Movidos para app/_archive/teste-clareza/
- page-old.tsx, page-old-backup.tsx
- resultado/page-old.tsx, resultado/page-old-backup.tsx
- N√ÉO est√£o sendo importados em nenhum lugar

PONTOS FR√ÅGEIS:
1. Chat depende de campos que podem n√£o existir (is_profile_base)
2. Di√°rio novo tenta usar entry_type que pode n√£o existir
3. i18n incompleto pode causar textos misturados PT/EN

VARI√ÅVEIS DE AMBIENTE NECESS√ÅRIAS:
- N√ÉO CONSIGO VER O CONTE√öDO DO .env.local
- Necess√°rias: SUPABASE_URL, SUPABASE_ANON_KEY, OPENAI_API_KEY,
  GROQ_API_KEY, STRIPE_SECRET_KEY, STRIPE_PRICE_*, etc.

DUPLICA√á√ïES:
- lib/clarity-test-config.ts vs lib/clarityTestConfig.ts (legado)
- lib/clarity-index.ts vs lib/clarityIndex.ts (legado)
- Recomenda√ß√£o: Remover arquivos legados ap√≥s confirmar n√£o uso

TESTES AUTOMATIZADOS:
- Pasta __tests__/ existe com 2 itens
- Cobertura: N√ÉO CONSIGO CONFIRMAR EXTENS√ÉO
- jest.config.js configurado

================================================================================
[10] IMPLEMENTA√á√ïES RECENTES (29/11/2025 19:00)
================================================================================

GATE DE LOGIN NO RESULTADO DO TESTE:
- Arquivo: app/teste-clareza/resultado/page.tsx
- Comportamento: Usu√°rio faz teste ‚Üí resultado fica bloqueado
- Se n√£o logado ‚Üí mostra tela de criar conta/login
- Preview borrado do resultado com cadeado
- Ap√≥s autenticar ‚Üí mostra resultado completo
- Commit: 29c60fd

VERIFICA√á√ÉO DE LIMITES POR PLANO:
- Arquivos modificados:
  - app/chat/page.tsx
  - app/diario/novo/page.tsx
- Hook usado: usePlanLimits() de hooks/usePlanLimits.ts
- Comportamento:
  - Chat: verifica canSendMessage antes de enviar
  - Di√°rio: verifica canCreateEntry antes de criar
  - Modal de limite atingido com:
    - Mensagem clara sobre o limite
    - Op√ß√£o de aguardar reset
    - Bot√£o para ver planos (upgrade)
- Commit: f724b60

DOCUMENTA√á√ÉO:
- Criado: docs/RADAR-IMPLEMENTACOES.md
- Cont√©m: Status completo de cada etapa do MVP
- Commit: 8968c88

================================================================================
[14] EDITOR VISUAL DA FRONTPAGE (30/11/2025)
================================================================================

CONCEITO:
Sistema para editar textos e se√ß√µes da frontpage sem c√≥digo.
Alternativa ao WordPress/Elementor, integrado ao Next.js.

NOVA TABELA (migration: 007_frontpage_config.sql):
- frontpage_config: Configura√ß√µes edit√°veis da frontpage
  - config_key: Identificador √∫nico (hero, faq, testimonials, etc.)
  - config_value: JSONB com os dados da se√ß√£o
  - is_active: Ativar/desativar se√ß√£o
  - RLS: Leitura p√∫blica, escrita apenas admins

NOVOS ARQUIVOS:
- database/migrations/007_frontpage_config.sql: Schema + seed
- app/api/admin/frontpage-editor/route.ts: API CRUD
- app/admin/frontpage-editor/page.tsx: Editor por formul√°rios
- app/admin/frontpage-visual/page.tsx: Editor visual com preview
- hooks/useFrontpageConfig.ts: Hook para consumir configs

SE√á√ïES EDIT√ÅVEIS:
| config_key    | Descri√ß√£o                    |
|---------------|------------------------------|
| general       | Nome do site, banner promo   |
| hero          | T√≠tulo, subt√≠tulo, CTAs      |
| stats         | Estat√≠sticas num√©ricas       |
| faq           | Perguntas frequentes         |
| testimonials  | Depoimentos de usu√°rias      |
| cta_final     | Call-to-action final         |
| sections_order| Ordem e visibilidade         |

FUNCIONALIDADES:
‚úÖ Editor por formul√°rios (/admin/frontpage-editor)
‚úÖ Editor visual com preview em tempo real (/admin/frontpage-visual)
‚úÖ Preview responsivo (desktop/tablet/mobile)
‚úÖ Ativar/desativar se√ß√µes
‚úÖ Adicionar/remover itens de FAQ e depoimentos
‚úÖ Salvar no Supabase
‚úÖ Fallback para valores padr√£o se tabela n√£o existir

NOTA SOBRE BUILDER.IO:
- Tentativa de instalar Builder.io falhou
- Requer Visual Studio C++ no Windows (node-gyp)
- Solu√ß√£o: Editor visual pr√≥prio criado

PR√ìXIMO PASSO:
- Rodar migration 007 no Supabase
- Conectar frontpage real ao hook useFrontpageConfig

================================================================================
[15] TRI√ÇNGULO V2 ‚Äì FILTROS + MAPA NO DASHBOARD (30/11/2025 11:30)
================================================================================

ETAPA 6 IMPLEMENTADA:

OBJETIVO:
Deixar o Tri√¢ngulo CLAREZA ‚áÑ DI√ÅRIO ‚áÑ CHAT vis√≠vel, filtr√°vel e f√°cil de entender.

IMPLEMENTA√á√ïES:

1. FILTROS NO /diario (app/diario/page.tsx):
   - Novo estado: entryTypeFilter ('all' | 'clarity_baseline' | 'chat_summary' | 'normal')
   - Painel de filtros no topo: "Tipo de entrada"
   - Bot√µes: Todos, Perfil de Clareza, Resumo do Chat, Epis√≥dios Normais
   - Mensagens amig√°veis quando filtro n√£o retorna resultados

2. FILTROS + LEGENDA NO /diario/timeline (app/diario/timeline/page.tsx):
   - Mesmo filtro por entry_type
   - Legenda visual do Tri√¢ngulo:
     ‚ú® Perfil de Clareza (clarity_baseline)
     üí¨ Resumo do Chat (chat_summary)
     üî• Intenso (mood_intensity >= 7)

3. CARD "ESTADO DO TRI√ÇNGULO" NO /dashboard (app/dashboard/page.tsx):
   - Novo estado: triangleState com dados dos 3 lados
   - Card com 3 colunas: Clareza / Di√°rio / Chat
   - Dados mostrados:
     - Clareza: Perfil base salvo? + data do √∫ltimo
     - Di√°rio: Epis√≥dios nos √∫ltimos 30 dias + intensos
     - Chat: Resumos nos √∫ltimos 30 dias + data do √∫ltimo
   - Status geral:
     - "‚úÖ Tri√¢ngulo Ativo" se os 3 lados t√™m dados
     - "‚ö†Ô∏è Incompleto" se falta algum lado
   - Mensagem explicativa do que falta

PENDENTE-V2 (N√ÉO IMPLEMENTADO):
- Auto-resumo IA no Chat (gera√ß√£o autom√°tica de resumo)

================================================================================
[16] ETAPA 7.3 ‚Äì PLANO DE SEGURAN√áA INTEGRADO AO TRI√ÇNGULO (30/11/2025 15:20)
================================================================================

OBJETIVO:
Integrar o m√≥dulo "Plano de Seguran√ßa" com o Tri√¢ngulo de Risco (Clareza ‚áÑ Di√°rio ‚áÑ Chat).

IMPLEMENTA√á√ïES CONCLU√çDAS:

1. API REST /api/safety-plan:
   - GET: Retorna plano do usu√°rio + status calculado
   - POST: Cria novo plano + entrada no di√°rio (entry_type='safety_plan')
   - PATCH: Atualiza plano + entrada no di√°rio
   - Status: NOT_STARTED | IN_PROGRESS | READY
   - Arquivo: app/api/safety-plan/route.ts

2. DASHBOARD - Card "Plano de Seguran√ßa":
   - Busca status via API
   - Cores por status: cinza (NOT_STARTED), amarelo (IN_PROGRESS), verde (READY)
   - √çcone Shield, link para /plano-seguranca
   - Arquivo: app/dashboard/page.tsx

3. DASHBOARD - Banner de Risco F√≠sico:
   - Aparece se hasPhysicalRisk = true E plano n√£o est√° READY
   - Cor varia conforme status do plano
   - Mensagem incentiva completar o plano
   - Arquivo: app/dashboard/page.tsx

4. CHAT - Detec√ß√£o de Risco F√≠sico:
   - Regex PHYSICAL_RISK_REGEX detecta frases de risco
   - Banner vermelho quando detectado
   - Cria risk_alert autom√°tico via API
   - Arquivo: app/chat/page.tsx + app/api/chat/route.ts

5. DI√ÅRIO - Badge "Plano de Seguran√ßa":
   - Badge üõ°Ô∏è para entradas com entry_type='safety_plan'
   - Estilo vermelho para destaque
   - Arquivos: app/diario/page.tsx + app/diario/timeline/page.tsx

6. TESTE DE CLAREZA - risk_alert autom√°tico:
   - Quando hasPhysicalRisk = true ao salvar perfil base
   - Cria risk_alert com category='PHYSICAL_VIOLENCE'
   - Arquivo: app/api/clarity/activate-profile/route.ts

7. TIPOS ATUALIZADOS:
   - JournalEntryType += 'safety_plan'
   - Arquivo: types/database.ts

TABELAS UTILIZADAS:
- safety_plans (j√° existia)
- risk_alerts (j√° existia)
- journal_entries (campo entry_type)
- clarity_tests (campo has_physical_risk)

================================================================================
[17] ETAPA 8 ‚Äì FANPAGE VIVA + CAMADA COMERCIAL (EM ANDAMENTO)
================================================================================

STATUS: PARCIALMENTE IMPLEMENTADO (ETAPA 8.1 + 8.2 CONCLU√çDAS)

OBJETIVO:
Transformar a frontpage em um organismo vivo que:
- Absorve sinais do n√∫cleo interno (Clareza, Di√°rio, Chat, Plano de Seguran√ßa)
- Absorve sinais do mundo externo (not√≠cias, estudos, podcasts)
- Tudo passa pelo filtro do Eduardo (admin) antes de publicar
- IAs como equipe editorial, Eduardo como editor-chefe

================================================================================
ETAPA 8.1 ‚Äì SCHEMA DO CONTENT SYSTEM (‚úÖ CONCLU√çDO 30/11/2025 18:25)
================================================================================

MIGRATION: database/migrations/20241130_create_content_system.sql

TABELAS CRIADAS:
1. content_sources - Fontes externas confi√°veis (blogs, podcasts, etc.)
2. content_items - Conte√∫dos publicados (artigos, FAQs, not√≠cias, li√ß√µes)
3. content_suggestions - Sugest√µes de conte√∫do (IA + manual)
4. content_collections - Trilhas/cole√ß√µes (Radar Academy)
5. content_collection_items - Ponte N:N cole√ß√£o ‚Üî conte√∫do
6. content_insights - M√©tricas agregadas (Radar em N√∫meros)

RLS CONFIGURADO:
- Leitura p√∫blica apenas para visibility='public'
- Escrita apenas para admins autenticados

SEED DATA:
- 6 m√©tricas iniciais em content_insights
- 3 FAQs iniciais em content_items

================================================================================
ETAPA 8.2 ‚Äì APIS ADMIN + IA CURADORA (‚úÖ CONCLU√çDO 30/11/2025 19:15)
================================================================================

PADR√ÉO DE ADMIN:
- Usa requireAdminAPI() de lib/admin-auth.ts
- Emails admin: etailoffice@gmail.com, eduardo.mkt.davila@gmail.com
- Roles: ADMIN ou SUPER_ADMIN em user_profiles.role

APIS CRIADAS (9 endpoints):

1. /api/admin/content/items (GET, POST)
   - Lista com filtros: visibility, content_type, source_type, search, topics, featured
   - Cria novo content_item
   - Arquivo: app/api/admin/content/items/route.ts

2. /api/admin/content/items/[id] (GET, PATCH, DELETE)
   - Detalhe, atualiza√ß√£o, arquivamento (soft delete)
   - Arquivo: app/api/admin/content/items/[id]/route.ts

3. /api/admin/content/suggestions (GET, POST)
   - Lista com filtros: status, suggestion_source, priority, search
   - Cria sugest√£o manual
   - Arquivo: app/api/admin/content/suggestions/route.ts

4. /api/admin/content/suggestions/[id] (GET, PATCH, DELETE)
   - Detalhe, atualiza√ß√£o, remo√ß√£o
   - PATCH com publish_now=true cria content_item automaticamente
   - Arquivo: app/api/admin/content/suggestions/[id]/route.ts

5. /api/admin/content/collections (GET, POST)
   - Lista com filtros: visibility, collection_type, featured, premium
   - Cria nova cole√ß√£o
   - Arquivo: app/api/admin/content/collections/route.ts

6. /api/admin/content/collections/[id] (GET, PATCH, DELETE)
   - Detalhe, atualiza√ß√£o, arquivamento
   - Arquivo: app/api/admin/content/collections/[id]/route.ts

7. /api/admin/content/collections/[id]/items (GET, POST, PATCH, DELETE)
   - Gerencia itens dentro de uma cole√ß√£o
   - Arquivo: app/api/admin/content/collections/[id]/items/route.ts

8. /api/admin/content/insights/recompute (GET, POST)
   - GET: Status das m√©tricas atuais
   - POST: Recalcula todas as m√©tricas
   - Arquivo: app/api/admin/content/insights/recompute/route.ts

9. /api/admin/content/curadoria/ia-sugerir (POST)
   - Recebe raw_text ou original_url + source_type
   - Usa Groq (fallback OpenAI) para gerar sugest√£o
   - Cria registro em content_suggestions com status='pending'
   - Arquivo: app/api/admin/content/curadoria/ia-sugerir/route.ts

LIB AUXILIAR:
- lib/content-insights.ts
  - recomputeContentInsights(): Calcula 7 m√©tricas
  - getPublicInsights(): Busca m√©tricas p√∫blicas

M√âTRICAS CALCULADAS:
| M√©trica                        | Categoria   | Visibilidade |
|--------------------------------|-------------|--------------|
| total_users                    | general     | public       |
| tests_completed_30d            | engagement  | public       |
| diary_entries_30d              | engagement  | public       |
| chat_sessions_30d              | engagement  | public       |
| safety_plans_created           | safety      | public       |
| risk_alerts_30d                | safety      | admin_only   |
| percent_users_physical_risk_high | safety    | admin_only   |

IA CURADORA:
- Usa chatGroq e chatOpenAI de lib/ia-conexoes-reais.ts
- Prompt √©tico em PT-BR com regras:
  - N√ÉO romantizar abuso
  - N√ÉO usar linguagem sensacionalista
  - N√ÉO fazer diagn√≥sticos cl√≠nicos
  - N√ÉO sugerir vingan√ßa
  - SEMPRE focar em educa√ß√£o e prote√ß√£o
- Gera: t√≠tulo, resumo, tipo, tags, relev√¢ncia (0-1), riscos/gatilhos
- Salva em content_suggestions com suggestion_source='ai_curator'

================================================================================
ETAPA 8.3 ‚Äì TELAS ADMIN DE CURADORIA (‚úÖ CONCLU√çDO 30/11/2025 20:15)
================================================================================

P√ÅGINAS CRIADAS:
- [x] /admin/conteudos/sugestoes - Gerenciar sugest√µes da IA Curadora
- [x] /admin/conteudos/publicados - Gerenciar conte√∫dos publicados
- [x] /admin/conteudos/colecoes - Gerenciar cole√ß√µes/trilhas (Radar Academy)
- [x] /admin/conteudos/insights - Visualizar e recalcular m√©tricas (Radar em N√∫meros)

ARQUIVOS CRIADOS:
- app/admin/conteudos/sugestoes/page.tsx
- app/admin/conteudos/publicados/page.tsx
- app/admin/conteudos/colecoes/page.tsx
- app/admin/conteudos/insights/page.tsx

REGISTRO ADMIN ATUALIZADO:
- app/admin/admin-features-registry.ts
  - Adicionados 4 novos IDs: conteudos_sugestoes, conteudos_publicados, conteudos_colecoes, conteudos_insights
  - Grupo: Dados
  - Ordem: 25-28

FUNCIONALIDADES POR P√ÅGINA:

1. /admin/conteudos/sugestoes:
   - Lista sugest√µes com filtros (status, fonte, busca)
   - Painel de detalhes com a√ß√µes (aprovar, publicar, rejeitar)
   - Modal IA Curadora para analisar novos conte√∫dos
   - Integra√ß√£o com /api/admin/content/suggestions

2. /admin/conteudos/publicados:
   - Tabela de conte√∫dos com filtros (visibilidade, tipo, busca)
   - Modal de edi√ß√£o com campos: t√≠tulo, resumo, corpo (Markdown), tags
   - Criar novo conte√∫do
   - Arquivar conte√∫do (soft delete)
   - Integra√ß√£o com /api/admin/content/items

3. /admin/conteudos/colecoes:
   - Lista de cole√ß√µes com sele√ß√£o
   - Painel de detalhes com itens da cole√ß√£o
   - Adicionar/remover itens
   - Criar/editar cole√ß√µes
   - Integra√ß√£o com /api/admin/content/collections

4. /admin/conteudos/insights:
   - Cards de m√©tricas p√∫blicas e admin-only
   - Bot√£o "Recalcular M√©tricas"
   - Formata√ß√£o de valores (K, M, %)
   - Timestamp de √∫ltima atualiza√ß√£o
   - Integra√ß√£o com /api/admin/content/insights/recompute

BUILD: 143 p√°ginas (antes 139)

================================================================================
ETAPA 8.4 ‚Äì BLOCOS DIN√ÇMICOS NA FRONTPAGE (‚úÖ CONCLU√çDO 30/11/2025 20:45)
================================================================================

SE√á√ïES EST√ÅTICAS (j√° existiam):
- [x] Hero com CTAs comerciais
- [x] Planos e Pre√ßos (integrado com billing_plans)
- [x] Se√ß√£o Inclusiva (Homens e Mulheres)
- [x] Checklist de Reconhecimento
- [x] O que √© Abuso Narcisista
- [x] Para Quem √© o Radar
- [x] Ciclo do Relacionamento
- [x] Mitos vs Realidade
- [x] Aprenda Mais
- [x] CTA Final + Footer

SE√á√ïES DIN√ÇMICAS (ETAPA 8.4):
- [x] Radar em N√∫meros (content_insights via API)
- [x] FAQ Din√¢mico (content_items type='faq')
- [x] Radar no Mundo (content_items source_type='external_*')
- [x] Radar Academy (content_collections)

ARQUIVOS CRIADOS:
- lib/frontpage-content.ts
  - getPublicInsights()
  - getPublicFaqItems()
  - getWorldNewsItems()
  - getAcademyCollections()
  - getFrontpageContent()

- app/api/frontpage/content/route.ts
  - GET: Retorna todos os dados din√¢micos
  - Cache: 5 minutos

- components/frontpage/
  - RadarEmNumerosSection.tsx
  - FaqDinamicoSection.tsx
  - RadarNoMundoSection.tsx
  - RadarAcademySection.tsx
  - DynamicSections.tsx (wrapper)

INTEGRA√á√ÉO:
- app/page.tsx importa DynamicSections
- Se√ß√µes inseridas ap√≥s Planos, antes de Se√ß√£o Inclusiva
- Se n√£o houver dados no banco, se√ß√µes n√£o aparecem

================================================================================
[16] FLUXO DE CONVITE PROFISSIONAL/CLIENTE
================================================================================

ETAPA 12.1 + 12.1.1 + 12.1.2 + 12.2 - Sistema Completo de Clientes Profissionais

TABELA: professional_clients
- id (UUID)
- professional_id (UUID ‚Üí auth.users)
- client_id (UUID ‚Üí auth.users, NULLABLE at√© aceite)
- status: 'pending' | 'active' | 'paused' | 'revoked'
- invite_code (TEXT UNIQUE, 8 caracteres)
- share_clarity_tests, share_journal_entries, share_chat_summaries (BOOLEAN)
- share_safety_plan, share_risk_alerts (BOOLEAN, sens√≠veis)
- client_display_name, professional_notes (TEXT)
- invite_sent_at, invite_accepted_at, last_activity_at (TIMESTAMPTZ)

FLUXO COMPLETO:
1. Profissional acessa /dashboard-profissional
2. Clica "Convidar Cliente" ‚Üí API POST /api/professional/clients
3. Sistema gera invite_code √∫nico (ex: "A1B2C3D4")
4. Profissional envia c√≥digo para cliente (manual por enquanto)
5. Cliente acessa /aceitar-convite ou /aceitar-convite?codigo=XXXXXXXX
6. Se n√£o logado: mostra op√ß√µes login/cadastro com redirect
7. Se logado: valida c√≥digo via POST /api/professional/invite/validate
8. Cliente escolhe permiss√µes (share_*) e confirma
9. API POST /api/professional/invite/accept atualiza:
   - client_id = usu√°rio logado
   - status = 'active'
   - share_* conforme escolhas
10. Profissional v√™ cliente ativo no dashboard
11. Profissional clica "Relat√≥rio" ‚Üí /dashboard-profissional/clientes/[id]
12. Cliente pode gerenciar em /configuracoes/profissionais

ROTAS DO PROFISSIONAL:
- /dashboard-profissional (lista de clientes)
- /dashboard-profissional/clientes/[id] (relat√≥rio por cliente)
- /api/professional/clients (GET, POST)
- /api/professional/clients/[id] (GET, PATCH, DELETE)
- /api/professional/invite/validate (POST)
- /api/professional/invite/accept (POST)
- /api/professional/reports/[clientId] (GET - relat√≥rio agregado)

ROTAS DO CLIENTE:
- /aceitar-convite (aceitar convite)
- /configuracoes/profissionais (gerenciar conex√µes)
- /api/client/connections (GET - listar conex√µes)
- /api/client/connections/[id] (PATCH - revogar/pausar/retomar/editar)

MIGRATIONS:
- 20241201_create_professional_clients.sql (tabela principal)
- 20241201_fix_professional_clients_nullable.sql (corre√ß√£o client_id)

RLS POLICIES:
- Profissional v√™/edita seus clientes
- Cliente v√™/edita suas conex√µes
- Convites pendentes podem ser validados publicamente (s√≥ c√≥digo)

LGPD/√âTICA:
- Cliente escolhe explicitamente o que compartilhar
- Aviso claro: "Radar N√ÉO substitui terapia/laudo"
- Cliente pode revogar acesso a qualquer momento
- Cliente pode pausar/retomar acesso
- Cliente pode editar permiss√µes (share_*) individualmente

RELAT√ìRIO DO PROFISSIONAL (V1):
- Resumo do cliente (nome, data conex√£o, √∫ltima atividade)
- M√≥dulos baseados em share_*:
  - Clareza: total testes, √∫ltima zona, evolu√ß√£o
  - Di√°rio: total entradas, entradas/semana, intensidade m√©dia
  - Chat: total sess√µes, sess√µes recentes
  - Seguran√ßa: plano existe? status
  - Alertas: total, n√£o resolvidos, recentes
- Bot√£o "Imprimir / PDF" via print do navegador
- Bot√£o "CSV" para exporta√ß√£o de dados (ETAPA 12.3)
- Aviso √©tico no topo

================================================================================
[17] INFRA WHITE-LABEL PROFISSIONAL (V1)
================================================================================

ETAPA 13 - Personaliza√ß√£o de Marca para Profissionais

TABELA: professional_brand
- id (UUID)
- professional_id (UUID ‚Üí auth.users, UNIQUE)
- display_name (TEXT) - Nome p√∫blico do profissional/cl√≠nica
- brand_color (TEXT) - Cor principal em hex (#RRGGBB)
- logo_url (TEXT) - URL do logo
- tagline (TEXT) - Especialidade/slogan
- show_radar_branding (BOOLEAN) - Mostrar "Powered by Radar"
- created_at, updated_at (TIMESTAMPTZ)

ROTAS:
- /dashboard-profissional/marca (configura√ß√£o de marca)
- /api/professional/brand (GET, POST)

FUNCIONALIDADES V1:
- Profissional configura nome p√∫blico
- Escolhe cor principal (predefinidas ou custom)
- Adiciona tagline/especialidade
- Cola URL de logo (upload ser√° V2)
- Preview em tempo real
- Toggle "Powered by Radar Narcisista"

RLS:
- Profissional s√≥ v√™/edita sua pr√≥pria marca
- Clientes podem ver marca do profissional conectado

PENDENTE (V2):
- Upload de logo direto
- Dom√≠nio/URL personalizada
- Temas completos (cores secund√°rias, fontes)
- Aplicar marca no convite e relat√≥rio

MIGRATION:
- 20241201_create_professional_brand.sql

================================================================================
[18] PR√ìXIMAS ETAPAS PLANEJADAS (BLOCO 14-20)
================================================================================

ESTADO ATUAL: ETAPAS 1-13 CONCLU√çDAS

PR√ìXIMAS ETAPAS (N√ÉO INICIADAS):

- ETAPA 14: Loja Simplificada (2-3 add-ons reais)
  - Planned no TUDO PARA O GPT, mas N√ÉO ENCONTREI IMPLEMENTA√á√ÉO COMPLETA no c√≥digo
  - P√°gina /loja existe (app/loja/page.tsx - 7KB)
  - Integra√ß√£o com Stripe para add-ons: AINDA N√ÉO IMPLEMENTADA
  - lib/addons-config.ts existe (11KB) - configura√ß√£o de add-ons

- ETAPA 15: Beta com 5 Usu√°rias
  - P√°gina /admin/beta-testers existe
  - Infra de observabilidade: PARCIALMENTE IMPLEMENTADA
  - Coleta de feedback: AINDA N√ÉO IMPLEMENTADA

- ETAPA 16: Or√°culo V1 (Analytics Consolidado)
  - /admin/analytics existe
  - /admin/metricas existe
  - /admin/insights existe
  - Consolida√ß√£o em vis√£o √∫nica: AINDA N√ÉO IMPLEMENTADA

- ETAPA 17: Limpeza/Unifica√ß√£o de Dashboards
  - /dashboard (principal usu√°ria - com trilha do her√≥i)
  - /dashboard-premium (vers√£o premium)
  - /dashboard-v2 (vers√£o alternativa)
  - /dashboard-profissional (profissionais)
  - Unifica√ß√£o: AINDA N√ÉO IMPLEMENTADA

- ETAPA 18: Limpeza Admin & Mapa do Sistema
  - /admin/mapa-sistema existe
  - /admin/mapa-ias existe
  - Organiza√ß√£o de menus: PARCIALMENTE IMPLEMENTADA

- ETAPA 19: Manuais (Usu√°ria, Profissional, Admin, Dev, White-label)
  - Pasta docs/ existe mas est√° vazia ou com poucos arquivos
  - Manuais estruturados: AINDA N√ÉO IMPLEMENTADOS

- ETAPA 20: L√¢mpada Geral (Observa√ß√µes e Pend√™ncias)
  - Arquivo LAMPADA-RADAR.txt: AINDA N√ÉO EXISTE
  - Rota /admin/lampada: AINDA N√ÉO EXISTE

================================================================================
FIM DO ATLAS ‚Äì 20 SE√á√ïES
================================================================================

Gerado em: 29/11/2025 18:10 (UTC-5)
Atualizado em: 01/12/2025 09:35 (UTC-5)
Tamanho aproximado: ~55KB
Se√ß√µes: 20

NOTA IMPORTANTE:
Este documento reflete o estado do C√ìDIGO no momento da gera√ß√£o.
O estado real do banco de dados Supabase N√ÉO PODE SER CONFIRMADO
a partir do c√≥digo. As migrations listadas como "pendentes" podem
j√° ter sido executadas manualmente.

MIGRATIONS PENDENTES:
- 007_frontpage_config.sql
- 20241130_create_content_system.sql
- 20241201_create_professional_clients.sql (ETAPA 12.1)
- 20241201_fix_professional_clients_nullable.sql (ETAPA 12.1.1)
- 20241201_create_professional_brand.sql (ETAPA 13)

Para confirmar o estado do banco:
1. Acessar Supabase Dashboard
2. Verificar se as tabelas/colunas existem
3. Executar migrations pendentes se necess√°rio
================================================================================
