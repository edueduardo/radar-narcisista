================================================================================
RADAR NARCISISTA ‚Äì ATLAS COMPLETO DO PROJETO (C√ìDIGO REAL)
================================================================================
Data/hora da gera√ß√£o: 29/11/2025 21:15 (UTC-5)
Ambiente: projeto local do Eduardo (Windsurf)
Gerado por: Windsurf AI (Cascade)

√öLTIMA ATUALIZA√á√ÉO: 29/11/2025 21:15
MUDAN√áAS DESDE √öLTIMA VERS√ÉO:
- Adicionada migration RLS para admins em billing_plans
- Corrigido acesso admin (getUser em vez de getSession)
- Sistema de Planos Administr√°veis 100% funcional
- Criados arquivos ROADMAP-RADAR.txt e TESTES-RADAR.txt

================================================================================
[√çNDICE]
================================================================================
1. Vis√£o geral do projeto
2. Rotas e p√°ginas (app/)
3. Fluxos principais
   3.1 Teste de Clareza
   3.2 Di√°rio
   3.3 Chat/Coach IA
   3.4 Dashboard
4. Esquema de banco (Supabase)
5. Planos e monetiza√ß√£o
6. Idiomas (i18n)
7. Seguran√ßa, LGPD e bot√£o de emerg√™ncia
8. Diferen√ßa entre vis√£o (TUDO PARA O GPT.txt) e c√≥digo real
9. Pend√™ncias t√©cnicas e riscos

================================================================================
[1] VIS√ÉO GERAL DO PROJETO
================================================================================

STACK T√âCNICA:
- Framework: Next.js 16.0.3 (App Router)
- Linguagem: TypeScript 5.x
- React: 19.2.0
- Estiliza√ß√£o: TailwindCSS 4.0.0
- Banco de dados: Supabase (PostgreSQL + Auth + Storage)
- Pagamentos: Stripe 20.0.0
- IAs: OpenAI 6.9.1 + Groq (via lib/ia-conexoes-reais.ts)
- PDF: jspdf 3.0.4 + @react-pdf/renderer 4.3.1
- Gr√°ficos: Recharts 3.5.0
- Anima√ß√µes: Framer Motion 12.23.24

PASTAS PRINCIPAIS:
- app/           ‚Üí Rotas e p√°ginas (App Router do Next.js)
- lib/           ‚Üí L√≥gica de neg√≥cio, configs, prompts, utils
- components/    ‚Üí Componentes React reutiliz√°veis
- hooks/         ‚Üí Hooks customizados (useI18n, useTermsAcceptance, etc.)
- database/      ‚Üí Schemas SQL e migrations
- public/        ‚Üí Assets est√°ticos
- scripts/       ‚Üí Scripts de build e verifica√ß√£o

√ÅREAS PRINCIPAIS DO SISTEMA:
1. Teste de Clareza (18 perguntas + 1 aberta, 3 eixos, 6 categorias)
2. Di√°rio de Epis√≥dios (registros com tags, anexos, an√°lise IA)
3. Chat/Coach IA (m√∫ltiplas IAs colaborativas)
4. Dashboard (vis√£o geral, alertas, recomenda√ß√µes)
5. Planos (Visitante, Guardar, Jornada, Defesa, Profissional)
6. Admin (painel administrativo completo)
7. Hub de Problemas (invalida√ß√£o, gaslighting, etc.)
8. Plano de Seguran√ßa (contatos, documentos, mala de emerg√™ncia)
9. Loja de Add-ons (funcionalidades extras)
10. Blog/Educa√ß√£o (conte√∫do sobre abuso narcisista)

================================================================================
[2] ROTAS E P√ÅGINAS (app/)
================================================================================

ROTAS PRINCIPAIS (verificadas no c√≥digo):

/ (Homepage)
  Arquivo: app/page.tsx (97KB)
  Fun√ß√£o: Landing page com hero, se√ß√µes de confian√ßa, "Como Funciona",
          bloco "Voc√™ escolhe como usar", ferramentas, planos, FAQ.
  Status: IMPLEMENTADA com i18n (PT/EN/ES)

/teste-clareza
  Arquivo: app/teste-clareza/page.tsx (47KB)
  Fun√ß√£o: Teste de Clareza com 18 perguntas objetivas + 1 aberta.
          Usa lib/clarity-unified-config.ts para configura√ß√£o.
  Status: IMPLEMENTADA

/teste-clareza/resultado
  Arquivo: app/teste-clareza/resultado/page.tsx
  Fun√ß√£o: Exibe resultado do teste com zonas, eixos, categorias,
          op√ß√£o de salvar como "base do Radar" ou apenas visualizar.
  Status: IMPLEMENTADA

/planos
  Arquivo: app/planos/page.tsx (15KB)
  Fun√ß√£o: P√°gina de planos com toggle mensal/anual.
          Usa lib/plans-config.ts para configura√ß√£o.
  Status: IMPLEMENTADA

/diario
  Arquivo: app/diario/page.tsx (17KB)
  Fun√ß√£o: Lista de entradas do di√°rio com filtros e busca.
  Status: IMPLEMENTADA

/diario/novo
  Arquivo: app/diario/novo/page.tsx
  Fun√ß√£o: Criar nova entrada no di√°rio com tags, anexos, an√°lise IA.
  Status: IMPLEMENTADA

/diario/[id]
  Arquivo: app/diario/[id]/page.tsx
  Fun√ß√£o: Visualizar entrada espec√≠fica do di√°rio.
  Status: IMPLEMENTADA

/diario/timeline
  Arquivo: app/diario/timeline/page.tsx
  Fun√ß√£o: Timeline visual dos epis√≥dios registrados.
  Status: IMPLEMENTADA

/chat
  Arquivo: app/chat/page.tsx (89KB)
  Fun√ß√£o: Chat com Coach IA de Clareza. Usa m√∫ltiplas IAs (OpenAI + Groq).
          Recebe contexto do perfil de clareza do usu√°rio.
  Status: IMPLEMENTADA

/dashboard
  Arquivo: app/dashboard/page.tsx
  Fun√ß√£o: Vis√£o geral do usu√°rio com recomenda√ß√µes e alertas.
  Status: IMPLEMENTADA

/plano-seguranca
  Arquivo: app/plano-seguranca/page.tsx
  Fun√ß√£o: Plano de seguran√ßa com contatos, documentos, mala de emerg√™ncia.
  Status: IMPLEMENTADA

/profissional
  Arquivo: app/profissional/page.tsx
  Fun√ß√£o: P√°gina para profissionais (terapeutas, advogados).
  Status: IMPLEMENTADA (com waitlist)

/loja
  Arquivo: app/loja/page.tsx
  Fun√ß√£o: Loja de add-ons e funcionalidades extras.
  Status: IMPLEMENTADA

/hub
  Arquivo: app/hub/page.tsx
  Fun√ß√£o: Hub de problemas (invalida√ß√£o, gaslighting, etc.).
  Status: IMPLEMENTADA

/admin/*
  Arquivos: app/admin/ (34 subpastas)
  Fun√ß√£o: Painel administrativo completo com:
          - Analytics, m√©tricas, custos IA
          - Gerenciamento de IAs, fluxos
          - Beta testers, comunidade
          - Configura√ß√µes, estados
  Status: IMPLEMENTADA

OUTRAS ROTAS RELEVANTES:
- /login, /cadastro ‚Üí Autentica√ß√£o
- /configuracoes ‚Üí Configura√ß√µes do usu√°rio
- /privacidade, /termos ‚Üí P√°ginas legais
- /blog ‚Üí Conte√∫do educativo
- /faq ‚Üí Perguntas frequentes
- /contato ‚Üí Formul√°rio de contato
- /seguranca, /seguranca-digital ‚Üí Recursos de seguran√ßa
- /modo-espelho, /espelho ‚Üí Ferramenta de reflex√£o
- /carta-futuro ‚Üí Cartas para o futuro
- /termometro ‚Üí Term√¥metro emocional
- /ciclo-abuso, /gaslighting, /love-bombing, /triangulacao ‚Üí Educa√ß√£o

================================================================================
[3] FLUXOS PRINCIPAIS
================================================================================

--------------------------------------------------------------------------------
[3.1] TESTE DE CLAREZA
--------------------------------------------------------------------------------

ARQUIVO DE CONFIGURA√á√ÉO PRINCIPAL:
lib/clarity-unified-config.ts (21KB)

ESTRUTURA DO TESTE:
- 18 perguntas objetivas (escala 0-4: Nunca ‚Üí Quase sempre)
- 1 pergunta aberta (narrativa do usu√°rio)
- Pesos diferentes por pergunta (1, 1.5, 2, 2.5, 3)

3 EIXOS PRINCIPAIS:
1. N√©voa Mental (nevoa) - Confus√£o, gaslighting, d√∫vida
2. Medo e Tens√£o (medo) - Medo de rea√ß√µes, tens√£o constante
3. Desrespeito a Limites (limites) - Limites ignorados, isolamento

6 CATEGORIAS DETALHADAS:
1. Invalida√ß√£o (3 perguntas) - Eixo: N√©voa
2. Gaslighting (3 perguntas) - Eixo: N√©voa
3. Controle (3 perguntas) - Eixo: Medo
4. Isolamento (3 perguntas) - Eixo: Limites
5. Abuso Emocional (3 perguntas) - Eixo: Medo
6. Risco F√≠sico (3 perguntas) - Eixo: Limites (peso alto)

ZONAS GLOBAIS:
- Zona de Aten√ß√£o (0-33%): Sinais leves
- Zona de Alerta (33-66%): Sinais moderados
- Zona de Alto Risco (66-100%): Sinais graves

ARQUIVO DE VOZES:
lib/clarity-questions-voices.ts (11KB)
- 3 vozes: Cient√≠fica, Amiga, Direta
- Cada pergunta tem texto adaptado para cada voz

FLUXO "GUARDAR X VER APENAS":
- Visitante: Faz teste, v√™ resultado, n√£o salva
- Logado: Pode escolher "Guardar como base do Radar"
- API: app/api/clarity/activate-profile/route.ts
- Quando salva: is_profile_base = true, gera resumo IA

RESUMO AUTOM√ÅTICO POR IA:
- Fun√ß√£o: generateAISummary() em activate-profile/route.ts
- Usa provedores: Groq > OpenAI > Claude > Gemini
- Gera 3-5 frases emp√°ticas sem diagn√≥stico
- Salvo no campo `summary` da tabela clarity_tests

--------------------------------------------------------------------------------
[3.2] DI√ÅRIO (UNIFICADO EM 29/11/2025)
--------------------------------------------------------------------------------

ROTAS OFICIAIS:
- /diario ‚Üí Lista de entradas (fonte de verdade dos epis√≥dios)
- /diario/novo ‚Üí Criar entrada com tags, anexos, an√°lise IA
- /diario/[id] ‚Üí Visualizar entrada espec√≠fica
- /diario/[id]/editar ‚Üí Editar entrada espec√≠fica
- /diario/timeline ‚Üí Timeline de Padr√µes (estat√≠sticas, problemas detectados)

ROTAS ARQUIVADAS (em app/_archive/):
- /diario-premium ‚Üí Vers√£o experimental com design premium (ARQUIVADA)
- /timeline-premium ‚Üí Duplicata da timeline (ARQUIVADA)
- /linha-tempo ‚Üí Timeline de fases do ciclo de abuso (ARQUIVADA - ser√° V2)

REGRA DE OURO:
"O Di√°rio √© a fonte de verdade dos epis√≥dios. A Timeline de Padr√µes s√≥ l√™/analisa
o que est√° em journal_entries + tags + clareza."

TABELA: journal_entries
- id, user_id, created_at, updated_at, deleted_at
- title, context (RELACIONAMENTO/FAMILIA/TRABALHO/OUTRO)
- content, mood_intensity (0-10), highlight, tags[]
- from_voice (se veio de transcri√ß√£o)
- entry_type (normal, clarity_baseline) - NOVO
- clarity_test_id (refer√™ncia ao teste) - NOVO

INTEGRA√á√ÉO COM TESTE DE CLAREZA (ETAPA 2 - TRI√ÇNGULO):
- Quando usu√°rio salva teste como base, CRIA entrada autom√°tica no di√°rio
- entry_type = 'clarity_baseline'
- clarity_test_id = ID do teste
- Tags sugeridas baseadas nos eixos do teste (gaslighting, medo, controle, etc.)
- T√≠tulo: "üìä Radiografia da Rela√ß√£o ‚Äì [Zona]"
- Implementado em: app/api/clarity/activate-profile/route.ts

INTEGRA√á√ÉO COM CHAT (ETAPA 2 - TRI√ÇNGULO):
- Chat recebe contexto dos √∫ltimos 3 epis√≥dios mais intensos (30 dias)
- Chat recebe perfil de clareza do usu√°rio
- Implementado em: app/api/chat/route.ts (getDiaryContextForChat)

INTEGRA√á√ÉO COM NOVA ENTRADA (ETAPA 2 - TRI√ÇNGULO):
- /diario/novo aceita query string: ?from=clarity_result&clarity_test_id=UUID
- Pr√©-preenche t√≠tulo, tags, impacto e descri√ß√£o baseado no perfil de clareza
- Salva entry_type e clarity_test_id no insert
- Implementado em: app/diario/novo/page.tsx

ANEXOS:
- Tabela: journal_attachments
- Tipos: IMAGE, AUDIO, PDF, VIDEO, OTHER
- Storage: Supabase Storage

--------------------------------------------------------------------------------
[3.3] CHAT/COACH IA
--------------------------------------------------------------------------------

ROTA: /chat
ARQUIVO: app/chat/page.tsx (89KB)

SISTEMA DE IAs:
- lib/chat-colaborativo.ts - Sistema de m√∫ltiplas IAs
- lib/ia-conexoes-reais.ts - Conex√µes com OpenAI e Groq
- lib/prompts/coachPrompt.ts - Prompt do Coach de Clareza

PROMPT DO COACH:
- Persona: "Radar Narcisista ‚Äì Coach de Clareza"
- Tom: Amigo respons√°vel brasileiro
- Regras: Responder diretamente, sugerir passos, poucas perguntas
- Limites: N√£o √© terapia, n√£o faz diagn√≥stico
- Protocolo de crise: CVV 188, Pol√≠cia 190, Mulher 180
- Guardrails anti-vingan√ßa: Detecta e recusa ajudar com vingan√ßa
- Detec√ß√£o de fraude: Red flags para relatos inconsistentes

INTEGRA√á√ÉO COM PERFIL DE CLAREZA:
- Busca perfil do usu√°rio (is_profile_base = true)
- Injeta contexto silencioso com:
  - Zona atual, percentual geral
  - Scores dos 3 eixos
  - Alerta de risco f√≠sico (se houver)
  - Resumo gerado pela IA
- IA usa contexto para personalizar respostas

API: /api/chat
- Recebe: message, history, userLocation, clarityProfile
- Detecta problemas no texto (gaslighting, invalida√ß√£o, etc.)
- Detecta red flags de fraude/m√°-f√©
- Retorna: reply, transparencia (IAs usadas, consenso)

--------------------------------------------------------------------------------
[3.4] DASHBOARD
--------------------------------------------------------------------------------

ROTA: /dashboard
ARQUIVO: app/dashboard/page.tsx

CONTE√öDO:
- Resumo do perfil de clareza (se existir)
- √öltimas entradas do di√°rio
- Alertas de risco (se houver)
- Recomenda√ß√µes personalizadas
- Atalhos para ferramentas

VARIANTES:
- /dashboard-v2 ‚Üí Vers√£o alternativa
- /dashboard-premium ‚Üí Vers√£o para planos pagos

================================================================================
[4] ESQUEMA DE BANCO (SUPABASE)
================================================================================

ARQUIVO: database/schema.sql (20KB)

TABELAS PRINCIPAIS:

user_profiles
- user_id (PK, FK ‚Üí auth.users)
- name, role (USER/ADMIN/SUPER_ADMIN)
- created_at, updated_at

user_settings
- user_id (PK, FK ‚Üí auth.users)
- save_history, save_voice_audio
- allow_ai_learning_product, allow_ai_dataset_research
- created_at, updated_at

clarity_tests
- id (PK), user_id (FK)
- fog_score, fear_score, limits_score (0-16 cada)
- global_zone (ATENCAO/ALERTA/VERMELHA)
- raw_answers (JSONB), summary (TEXT)
- from_voice (BOOLEAN)
- NOVOS CAMPOS (migrations pendentes):
  - is_profile_base (BOOLEAN)
  - user_narrative (TEXT)
  - overall_percentage (DECIMAL)
  - has_physical_risk (BOOLEAN)
  - test_type (TEXT)
  - category_scores (JSONB)
  - axis_scores (JSONB)
  - ip_hash (TEXT)
  - completed_at (TIMESTAMPTZ)

journal_entries
- id (PK), user_id (FK)
- title, context, content
- mood_intensity, highlight, tags[]
- from_voice, deleted_at
- NOVOS CAMPOS (migrations pendentes):
  - entry_type (TEXT)
  - clarity_test_id (FK ‚Üí clarity_tests)

journal_attachments
- id (PK), journal_entry_id (FK), user_id (FK)
- type, filename, storage_path
- description, transcription

ai_chat_sessions
- id (PK), user_id (FK)
- name, kind (USER_COACH, AI_STUDIO_*)

ai_messages
- id (PK), session_id (FK), user_id (FK)
- role (user/assistant/system/meta)
- content, from_voice, meta (JSONB)

subscriptions
- id (PK), user_id (FK)
- stripe_subscription_id, stripe_customer_id
- status, price_id, amount, currency
- current_period_start/end, cancel_at_period_end

safety_plans
- id (PK), user_id (FK)
- emergency_contacts (JSONB)
- important_documents (JSONB)
- emergency_bag_items (JSONB)
- safe_place (JSONB)
- digital_security (JSONB)
- overall_status, notes

risk_alerts
- id (PK), user_id (FK)
- source, source_id, level, category
- title, description, recommendation
- is_read, is_dismissed

waitlist (NOVA - migration pendente)
- id (PK), email, source
- created_at, notified_at, converted_at
- metadata (JSONB)

MIGRATIONS PENDENTES (database/migrations/):
1. 20241129_add_clarity_profile_base.sql
2. 20241129_add_clarity_extra_fields.sql
3. 20241129_add_diary_clarity_fields.sql
4. 20241129_create_waitlist.sql

RLS (Row Level Security):
- Todas as tabelas t√™m RLS habilitado
- Pol√≠ticas: usu√°rio s√≥ v√™/edita seus pr√≥prios dados
- Admins t√™m acesso especial via role

================================================================================
[5] PLANOS E MONETIZA√á√ÉO
================================================================================

ARQUIVO: lib/plans-config.ts (11KB)

5 N√çVEIS DE PLANO:

1. VISITANTE (sem conta)
   - legacyId: 'visitante'
   - Pre√ßo: Gr√°tis
   - Limites: 1 teste/m√™s, 0 di√°rio, 0 chat
   - Features: Teste 1x, ver resultado na tela
   - N√ÉO inclui: PDF, salvar, di√°rio, coach

2. RADAR GUARDAR (gratuito com conta)
   - legacyId: 'gratuito'
   - Pre√ßo: Gr√°tis
   - Limites: Testes ilimitados, 3 di√°rio/m√™s, 5 chat/dia
   - Features: Salvar resultado, di√°rio b√°sico, coach b√°sico
   - N√ÉO inclui: PDF, hist√≥rico completo

3. RADAR JORNADA (ex-Essencial)
   - legacyId: 'essencial'
   - Pre√ßo: R$29,90/m√™s ou R$299/ano
   - Limites: Ilimitado di√°rio, 50 chat/dia
   - Features: Tudo do Guardar + PDF, hist√≥rico, an√°lise padr√µes

4. RADAR DEFESA (ex-Premium)
   - legacyId: 'premium'
   - Pre√ßo: R$49,90/m√™s ou R$499/ano
   - Limites: Ilimitado tudo
   - Features: Tudo do Jornada + IAs colaborativas, relat√≥rios avan√ßados
   - popular: true

5. RADAR PROFISSIONAL (futuro)
   - legacyId: 'profissional'
   - Pre√ßo: R$99,90/m√™s
   - comingSoon: true
   - Para: Terapeutas, advogados
   - Features: M√∫ltiplos clientes, relat√≥rios profissionais

INTEGRA√á√ÉO STRIPE:
- Arquivo: lib/stripe.ts
- API: app/api/stripe/checkout, webhook, portal
- Price IDs: via env (STRIPE_PRICE_ESSENCIAL_MENSAL, etc.)

================================================================================
[6] IDIOMAS (i18n)
================================================================================

ARQUIVO: lib/i18n.ts (36KB)

IDIOMAS SUPORTADOS:
- pt-BR (Portugu√™s Brasileiro) - DEFAULT
- en (English)
- es (Espa√±ol)

ESTRUTURA:
- translations: Record<Locale, Record<string, string>>
- frontpageDictionaries: Dicion√°rios estruturados para homepage

P√ÅGINAS COM i18n IMPLEMENTADO:
- app/page.tsx (homepage) - PARCIAL
  - Se√ß√µes: Hero, Como Funciona, Ferramentas, Planos, Garantias
  - Bloco "Voc√™ escolhe como usar"
  - Algumas listas ainda hardcoded em PT-BR

P√ÅGINAS SEM i18n (hardcoded PT-BR):
- app/teste-clareza/page.tsx
- app/diario/*.tsx
- app/chat/page.tsx
- app/dashboard/page.tsx
- app/planos/page.tsx
- Maioria das outras p√°ginas

COMPONENTE SELETOR:
- components/LanguageSelector.tsx
- Salva prefer√™ncia no localStorage
- Recarrega p√°gina ao mudar idioma

================================================================================
[7] SEGURAN√áA, LGPD E BOT√ÉO DE EMERG√äNCIA
================================================================================

BOT√ÉO DE EMERG√äNCIA (ESC):
- Implementado em: components/EmergencyButton.tsx
- Atalho: Tecla ESC
- A√ß√£o: Redireciona para site neutro (Google)
- Presente em: Layout principal, p√°ginas sens√≠veis

TERMOS E RESPONSABILIDADE:
- Componente: components/ResponsibilityTermsModal.tsx
- Modal obrigat√≥rio no primeiro uso do chat
- 6 checkboxes obrigat√≥rios:
  1. Perspectiva unilateral
  2. Mentir √© crime (Art. 299 CP)
  3. Forjar provas √© crime (Art. 347 CP)
  4. Cal√∫nia/difama√ß√£o/inj√∫ria s√£o crimes
  5. Responsabilidade total pelo uso
  6. Ferramenta de apoio (n√£o substitui profissionais)
- Registra aceite no banco com timestamp

AVISOS NO FRONTEND:
- Chat: Microaviso abaixo do input
- Chat: Aviso peri√≥dico a cada 8 mensagens
- Chat: Modal de confirma√ß√£o antes de exportar PDF
- Di√°rio: Microaviso abaixo do campo de descri√ß√£o
- Timeline: Aviso completo com √≠cone

LGPD:
- Tabela user_settings com prefer√™ncias de privacidade
- save_history, save_voice_audio
- allow_ai_learning_product, allow_ai_dataset_research
- Rota /configuracoes para gerenciar prefer√™ncias
- Rota /privacidade com pol√≠tica de privacidade

EXPORTAR/APAGAR DADOS:
- Rota /dados-e-ia para visualizar dados
- Funcionalidade de exportar dados: PARCIALMENTE IMPLEMENTADA
- Funcionalidade de apagar conta: PARCIALMENTE IMPLEMENTADA

================================================================================
[8] DIFEREN√áA ENTRE VIS√ÉO (TUDO PARA O GPT.txt) E C√ìDIGO REAL
================================================================================

TESTE DE CLAREZA:
- Vis√£o: 18 perguntas + 1 aberta, 3 eixos, 6 categorias, vozes
- C√≥digo: ‚úÖ IMPLEMENTADO CONFORME VIS√ÉO
- Diferen√ßa: Nenhuma significativa

FLUXO "GUARDAR X VER APENAS":
- Vis√£o: Escolha clara entre ver e guardar como base
- C√≥digo: ‚úÖ IMPLEMENTADO
- API activate-profile funcional
- Resumo IA gerado automaticamente

DI√ÅRIO:
- Vis√£o: Integra√ß√£o com teste de clareza, tags sugeridas
- C√≥digo: ‚úÖ IMPLEMENTADO
- Campos entry_type e clarity_test_id adicionados
- PENDENTE: Migrations precisam ser executadas no Supabase

CHAT/COACH IA:
- Vis√£o: M√∫ltiplas IAs, contexto do perfil, detec√ß√£o de fraude
- C√≥digo: ‚úÖ IMPLEMENTADO
- Sistema colaborativo OpenAI + Groq
- Contexto do perfil de clareza injetado
- Detec√ß√£o de red flags funcionando

PLANOS:
- Vis√£o: 5 n√≠veis (Visitante, Guardar, Jornada, Defesa, Profissional)
- C√≥digo: ‚úÖ IMPLEMENTADO
- Nomes comerciais corretos
- legacyId mantido para Stripe
- Profissional marcado como comingSoon

IDIOMAS:
- Vis√£o: PT/EN/ES em toda a plataforma
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- Homepage tem i18n
- Maioria das outras p√°ginas ainda hardcoded PT-BR

RADAR PROFISSIONAL:
- Vis√£o: Plano B2B para terapeutas/advogados
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /profissional existe com waitlist
- Funcionalidades espec√≠ficas: AINDA N√ÉO IMPLEMENTADAS

LOJA DE ADD-ONS:
- Vis√£o: Funcionalidades extras para compra avulsa
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /loja existe
- Integra√ß√£o com pagamento: AINDA N√ÉO IMPLEMENTADA

TRILHAS/CURSOS:
- Vis√£o: Conte√∫do educativo personalizado
- C√≥digo: ‚ö†Ô∏è PARCIALMENTE IMPLEMENTADO
- P√°gina /cursos existe
- Personaliza√ß√£o baseada no teste: AINDA N√ÉO IMPLEMENTADA

================================================================================
[9] PEND√äNCIAS T√âCNICAS E RISCOS
================================================================================

MIGRATIONS PENDENTES (CR√çTICO):
Os seguintes arquivos SQL existem mas podem n√£o ter sido executados:
1. database/migrations/20241129_add_clarity_profile_base.sql
   - Adiciona: is_profile_base, user_narrative, overall_percentage, etc.
2. database/migrations/20241129_add_clarity_extra_fields.sql
   - Adiciona: category_scores, axis_scores, ip_hash, summary, completed_at
3. database/migrations/20241129_add_diary_clarity_fields.sql
   - Adiciona: entry_type, clarity_test_id em journal_entries
4. database/migrations/20241129_create_waitlist.sql
   - Cria tabela waitlist com RLS

RISCO: Se as migrations n√£o forem executadas, o c√≥digo que usa esses campos
vai falhar silenciosamente ou com erro.

ARQUIVOS DE BACKUP:
- Movidos para app/_archive/teste-clareza/
- page-old.tsx, page-old-backup.tsx
- resultado/page-old.tsx, resultado/page-old-backup.tsx
- N√ÉO est√£o sendo importados em nenhum lugar

PONTOS FR√ÅGEIS:
1. Chat depende de campos que podem n√£o existir (is_profile_base)
2. Di√°rio novo tenta usar entry_type que pode n√£o existir
3. i18n incompleto pode causar textos misturados PT/EN

VARI√ÅVEIS DE AMBIENTE NECESS√ÅRIAS:
- N√ÉO CONSIGO VER O CONTE√öDO DO .env.local
- Necess√°rias: SUPABASE_URL, SUPABASE_ANON_KEY, OPENAI_API_KEY,
  GROQ_API_KEY, STRIPE_SECRET_KEY, STRIPE_PRICE_*, etc.

DUPLICA√á√ïES:
- lib/clarity-test-config.ts vs lib/clarityTestConfig.ts (legado)
- lib/clarity-index.ts vs lib/clarityIndex.ts (legado)
- Recomenda√ß√£o: Remover arquivos legados ap√≥s confirmar n√£o uso

TESTES AUTOMATIZADOS:
- Pasta __tests__/ existe com 2 itens
- Cobertura: N√ÉO CONSIGO CONFIRMAR EXTENS√ÉO
- jest.config.js configurado

================================================================================
[10] IMPLEMENTA√á√ïES RECENTES (29/11/2025 19:00)
================================================================================

GATE DE LOGIN NO RESULTADO DO TESTE:
- Arquivo: app/teste-clareza/resultado/page.tsx
- Comportamento: Usu√°rio faz teste ‚Üí resultado fica bloqueado
- Se n√£o logado ‚Üí mostra tela de criar conta/login
- Preview borrado do resultado com cadeado
- Ap√≥s autenticar ‚Üí mostra resultado completo
- Commit: 29c60fd

VERIFICA√á√ÉO DE LIMITES POR PLANO:
- Arquivos modificados:
  - app/chat/page.tsx
  - app/diario/novo/page.tsx
- Hook usado: usePlanLimits() de hooks/usePlanLimits.ts
- Comportamento:
  - Chat: verifica canSendMessage antes de enviar
  - Di√°rio: verifica canCreateEntry antes de criar
  - Modal de limite atingido com:
    - Mensagem clara sobre o limite
    - Op√ß√£o de aguardar reset
    - Bot√£o para ver planos (upgrade)
- Commit: f724b60

DOCUMENTA√á√ÉO:
- Criado: docs/RADAR-IMPLEMENTACOES.md
- Cont√©m: Status completo de cada etapa do MVP
- Commit: 8968c88

================================================================================
FIM DO ATLAS
================================================================================
Gerado em: 29/11/2025 18:10 (UTC-5)
Atualizado em: 29/11/2025 19:07 (UTC-5)
Tamanho aproximado: ~22KB
Se√ß√µes: 10

NOTA IMPORTANTE:
Este documento reflete o estado do C√ìDIGO no momento da gera√ß√£o.
O estado real do banco de dados Supabase N√ÉO PODE SER CONFIRMADO
a partir do c√≥digo. As migrations listadas como "pendentes" podem
j√° ter sido executadas manualmente.

Para confirmar o estado do banco:
1. Acessar Supabase Dashboard
2. Verificar se as colunas existem nas tabelas
3. Executar migrations pendentes se necess√°rio
================================================================================

================================================================================
[11] SISTEMA DE PLANOS ADMINISTR√ÅVEIS (29/11/2025)
================================================================================

IMPLEMENTA√á√ÉO COMPLETA:
Sistema para gerenciar planos e promo√ß√µes via admin, sem editar c√≥digo.

NOVAS TABELAS (migration: 20241129_create_billing_plans.sql):
- billing_plans: Planos de assinatura (B2C e B2B)
- billing_plan_promotions: Promo√ß√µes tempor√°rias

NOVOS ARQUIVOS:
- lib/types/billing.ts: Tipos TypeScript para billing
- lib/plan-service.ts: Servi√ßo server-side para planos
- app/admin/planos/page.tsx: Tela admin para gerenciar planos
- app/api/plans/route.ts: API para frontend buscar planos
- hooks/usePlans.ts: Hook com fallback para dados hardcoded

PLANOS CONFIGURADOS:
| C√≥digo      | Nome             | Tipo | Pre√ßo    | P√∫blico |
|-------------|------------------|------|----------|---------|
| visitante   | Visitante        | B2C  | Gr√°tis   | N√£o     |
| guardar     | Radar Guardar    | B2C  | Gr√°tis   | Sim     |
| jornada     | Radar Jornada    | B2C  | R$29,90  | Sim     |
| defesa      | Radar Defesa     | B2C  | R$49,90  | Sim     |
| intermedio  | Radar Essencial  | B2C  | R$19,90  | N√£o*    |
| profissional| Radar Profissional| B2B | R$99,90  | Sim     |

* intermedio: is_mid_bridge=true, is_public=false (para promo√ß√µes especiais)

FUNCIONALIDADES:
‚úÖ CRUD de planos via /admin/planos
‚úÖ CRUD de promo√ß√µes com datas de validade
‚úÖ Labels promocionais (ex: "Black Friday 50% OFF")
‚úÖ Pre√ßo original riscado quando h√° promo√ß√£o
‚úÖ Fallback autom√°tico para plans-config.ts se tabelas n√£o existirem
‚úÖ Integra√ß√£o com homepage e /planos

MIGRATIONS EXECUTADAS NO SUPABASE:
‚úÖ 20241129_create_billing_plans.sql - Tabelas criadas
‚úÖ 20241129_billing_rls_admin.sql - Pol√≠ticas RLS para admins

PR√ìXIMO PASSO:
Sistema de planos 100% funcional. Pr√≥ximo: testar promo√ß√µes.

================================================================================
[12] CORRE√á√ïES DE ACESSO ADMIN (29/11/2025 21:00)
================================================================================

PROBLEMA IDENTIFICADO:
- Admin n√£o conseguia acessar /admin ap√≥s deploy
- Erro: redirecionava para /dashboard?error=acesso_negado

CAUSA:
- getSession() n√£o estava funcionando corretamente na Vercel
- Verifica√ß√£o de email admin n√£o estava priorizando email hardcoded

CORRE√á√ÉO APLICADA:
- Arquivo: app/admin/page.tsx
- Mudan√ßa: getSession() ‚Üí getUser() (mais confi√°vel)
- Mudan√ßa: Verifica√ß√£o por email ANTES de verificar banco
- Adicionados logs de debug para Vercel

EMAILS ADMIN HARDCODED:
- etailoffice@gmail.com
- eduardo.mkt.davila@gmail.com

================================================================================
[13] ARQUIVOS DE MEM√ìRIA DO PROJETO (29/11/2025)
================================================================================

5 ARQUIVOS TXT NA RAIZ:
1. ATLAS-RADAR-NARCISISTA.txt - Mapa t√©cnico do c√≥digo real
2. TUDO PARA O GPT.txt - Vis√£o de produto, prompts, hist√≥rico
3. ESPELHO-CODIGO-RADAR.txt - Espelho completo do c√≥digo (gerado)
4. ROADMAP-RADAR.txt - Tarefas e prioridades
5. TESTES-RADAR.txt - Checklist de testes

SCRIPT PARA GERAR ESPELHO:
- Arquivo: scripts/gerar-espelho-codigo.cjs
- Comando: npm run espelho-codigo
- Sa√≠da: ESPELHO-CODIGO-RADAR.txt (4.3MB, 348 arquivos)
- Nota: Arquivo n√£o vai pro Git (muito grande)

================================================================================
FIM DO ATLAS
================================================================================
