================================================================================
RADAR NARCISISTA ‚Äì ROADMAP
================================================================================
Vers√£o: 1.9
√öltima atualiza√ß√£o: 30/11/2025 23:30 (UTC-5)

================================================================================
STATUS GERAL
================================================================================

Vers√£o atual do produto: MVP 0.9
Objetivo desta fase: Fechar MVP vend√°vel B2C

================================================================================
PRIORIDADE AGORA (N√ÉO MEXER NA ORDEM SEM AUTORIZA√á√ÉO)
================================================================================

1) ‚úÖ Sistema de Planos Administr√°veis (CONCLU√çDO 29/11/2025)
   - Tabelas billing_plans e billing_plan_promotions
   - Tela /admin/planos
   - Integra√ß√£o homepage e /planos
   - Promo√ß√µes com labels e datas

2) ‚úÖ Fechar Di√°rio (CONCLU√çDO 29/11/2025)
   - Rotas unificadas: /diario, /diario/novo, /diario/timeline
   - Conectado com Teste de Clareza (entry_type, clarity_test_id)
   - Timeline funcional com badges
   - Badges "Perfil de Clareza" e "Intenso"

3) ‚úÖ Fechar Chat (CONCLU√çDO 30/11/2025)
   - Coach IA usando contexto do teste ‚úÖ
   - Coach IA usando √∫ltimos di√°rios ‚úÖ
   - Limites por plano funcionando ‚úÖ
   - Chat ‚Üí Di√°rio (salvar resumo) ‚úÖ

4) ‚úÖ Editor Visual da Frontpage (CONCLU√çDO 30/11/2025)
   - Promo√ß√µes din√¢micas funcionando ‚úÖ
   - Planos lendo do banco ‚úÖ
   - Editor por formul√°rios (/admin/frontpage-editor) ‚úÖ
   - Editor visual com preview (/admin/frontpage-visual) ‚úÖ
   - Hook useFrontpageConfig.ts criado ‚úÖ
   - Migration 007_frontpage_config.sql criada ‚úÖ
   - PENDENTE: Rodar migration no Supabase

5) ‚úÖ Tri√¢ngulo V2 - Filtros + Mapa no Dashboard (CONCLU√çDO 30/11/2025)
   - Filtros por entry_type no /diario ‚úÖ
   - Filtros por entry_type no /diario/timeline ‚úÖ
   - Legenda do Tri√¢ngulo na Timeline (‚ú®, üí¨, üî•) ‚úÖ
   - Card "Estado do Tri√¢ngulo" no /dashboard ‚úÖ
   - Status "Tri√¢ngulo Ativo" ou "Incompleto" ‚úÖ
   - PENDENTE-V2: Auto-resumo IA no Chat

6) ‚úÖ ETAPA 7.3 - Plano de Seguran√ßa no Tri√¢ngulo (CONCLU√çDO 30/11/2025 15:20)
   - API REST /api/safety-plan (GET, POST, PATCH) ‚úÖ
   - Card "Plano de Seguran√ßa" no Dashboard ‚úÖ
   - Banner de risco f√≠sico no Dashboard ‚úÖ
   - Detec√ß√£o de risco f√≠sico no Chat (regex) ‚úÖ
   - Banner de alerta no Chat ‚úÖ
   - Cria√ß√£o de risk_alert via Chat ‚úÖ
   - Badge üõ°Ô∏è no Di√°rio e Timeline ‚úÖ
   - risk_alert autom√°tico no Teste de Clareza ‚úÖ
   - Tipo 'safety_plan' no JournalEntryType ‚úÖ
   - Build passou: 134 p√°ginas ‚úÖ

7) ‚úÖ ETAPA 7.4 - QA Tri√¢ngulo + Plano de Seguran√ßa (CONCLU√çDO 30/11/2025 16:45)
   - T1: Teste de Clareza com risco f√≠sico ‚Üí PASS ‚úÖ
   - T2: Chat com risco f√≠sico (regex) ‚Üí PASS ‚úÖ
   - T3: Plano de Seguran√ßa + Di√°rio ‚Üí PASS ‚úÖ
   - T4: Dashboard Card/Banners ‚Üí PASS ‚úÖ
   - T5: Seguran√ßa/RLS (user_id) ‚Üí PASS ‚úÖ
   - Todas APIs filtram por user_id autenticado ‚úÖ
   - Nenhum bug encontrado ‚úÖ
   - Build passou: 134 p√°ginas ‚úÖ

8) üîÑ ETAPA 8 - FanPage Viva + Camada Comercial (EM ANDAMENTO)
   OBJETIVO: Transformar frontpage em organismo vivo com curadoria
   
   ‚úÖ ETAPA 8.1 - Infraestrutura de Banco (CONCLU√çDO 30/11/2025 18:25)
   - [x] Tabela content_sources (fontes externas confi√°veis)
   - [x] Tabela content_items (conte√∫dos publicados)
   - [x] Tabela content_suggestions (sugest√µes IA + manual)
   - [x] Tabela content_collections (Radar Academy)
   - [x] Tabela content_collection_items (ponte N:N)
   - [x] Tabela content_insights (Radar em N√∫meros)
   - [x] RLS: leitura p√∫blica s√≥ para visibility='public'
   - [x] Triggers updated_at autom√°ticos
   - [x] Seed data: 6 m√©tricas + 3 FAQs iniciais
   - [x] Migration: 20241130_create_content_system.sql
   - [x] Build passou: 134 p√°ginas
   
   ‚úÖ ETAPA 8.2 - APIs Admin + IA Curadora (CONCLU√çDO 30/11/2025 19:15)
   - [x] /api/admin/content/items (GET, POST)
   - [x] /api/admin/content/items/[id] (GET, PATCH, DELETE)
   - [x] /api/admin/content/suggestions (GET, POST)
   - [x] /api/admin/content/suggestions/[id] (GET, PATCH, DELETE)
   - [x] /api/admin/content/collections (GET, POST)
   - [x] /api/admin/content/collections/[id] (GET, PATCH, DELETE)
   - [x] /api/admin/content/collections/[id]/items (GET, POST, PATCH, DELETE)
   - [x] /api/admin/content/insights/recompute (GET, POST)
   - [x] /api/admin/content/curadoria/ia-sugerir (POST)
   - [x] lib/content-insights.ts (7 m√©tricas calculadas)
   - [x] IA Curadora usando Groq/OpenAI existente
   - [x] Padr√£o admin: requireAdminAPI de lib/admin-auth.ts
   
   ‚úÖ ETAPA 8.3 - P√°ginas Admin de Curadoria (CONCLU√çDO 30/11/2025 20:15)
   - [x] /admin/conteudos/sugestoes (gerenciar sugest√µes IA Curadora)
   - [x] /admin/conteudos/publicados (gerenciar content_items)
   - [x] /admin/conteudos/colecoes (gerenciar trilhas/cole√ß√µes)
   - [x] /admin/conteudos/insights (Radar em N√∫meros - m√©tricas)
   - [x] admin-features-registry.ts atualizado com 4 novos IDs
   - [x] Build passou: 143 p√°ginas
   
   ‚úÖ ETAPA 8.4 - Blocos Din√¢micos na Frontpage (CONCLU√çDO 30/11/2025 20:45)
   - [x] Hero com CTAs comerciais (j√° existe)
   - [x] Planos e Pre√ßos (j√° existe, integrado com billing_plans)
   - [x] Radar em N√∫meros (content_insights via API)
   - [x] FAQ din√¢mico (content_items type='faq')
   - [x] Radar no Mundo (content_items source_type='external_*')
   - [x] Radar Academy (content_collections)
   - [x] lib/frontpage-content.ts (fun√ß√µes de busca)
   - [x] app/api/frontpage/content/route.ts (API p√∫blica)
   - [x] 5 componentes em components/frontpage/
   - [x] app/page.tsx integrado com DynamicSections
   
   NOTA: Se√ß√µes s√≥ aparecem se houver dados no banco. Rodar migration primeiro!

   ‚úÖ ETAPA 9 - Painel de Curadoria + Sem√°foro de Edi√ß√£o (CONCLU√çDO 30/11/2025 21:15)
   - [x] lib/curadoria-config.ts (get/update config)
   - [x] /api/admin/curadoria/config (GET/PATCH)
   - [x] components/admin/EditSemaforoBadge.tsx (badge + card + explanation)
   - [x] /admin/curadoria (painel central)
   - [x] Sem√°foro aplicado em 4 p√°ginas admin
   - [x] admin-features-registry.ts atualizado
   - [x] Build passou: 145 p√°ginas

   ‚úÖ ETAPA 10 - Infra de Planos, Fam√≠lias e M√≥dulos de Dashboard (CONCLU√çDO 30/11/2025 21:45)
   - [x] lib/plan-taxonomy.ts (PlanFamily, PLAN_TAXONOMY, fun√ß√µes auxiliares)
   - [x] lib/plan-dashboard-modules.ts (DashboardModuleId, DASHBOARD_MODULES)
   - [x] /admin/planos com SemaforoCard amarelo (zona sens√≠vel)
   - [x] Prepara√ß√£o para ETAPAS 11-13 (dashboards por plano)
   - [x] Build passou: 145 p√°ginas

   ‚úÖ ETAPA 11 - Redesenho do Dashboard do Usu√°rio - INFRA (CONCLU√çDO 30/11/2025 22:10)
   - [x] lib/plan-dashboard-modules.ts atualizado com heroStep e minPlanLevel
   - [x] lib/dashboard-user-layout.ts criado
   - [x] Fun√ß√µes: buildUserDashboardLayout, getWelcomeMessage, getNextSuggestedAction
   - [x] Trilha do her√≥i: 5 etapas (Entender, Registrar, Conversar, Proteger, Recursos)
   - [x] Backup: app/dashboard/page.BACKUP_ETAPA11.tsx
   - [x] Build passou: 145 p√°ginas
   
   NOTA: A infra est√° pronta. O visual do /dashboard pode ser atualizado
   incrementalmente usando buildUserDashboardLayout() sem quebrar nada.

================================================================================
PR√ìXIMAS ETAPAS (PRIORIDADE)
================================================================================

üîú ETAPA 11.1 - Aplicar trilha visual no /dashboard
   OBJETIVO: Reorganizar o dashboard em 5 se√ß√µes (Entender, Registrar, Conversar, Proteger, Recursos)
   INFRA PRONTA:
   - lib/plan-dashboard-modules.ts (heroStep, minPlanLevel)
   - lib/dashboard-user-layout.ts (buildUserDashboardLayout, getWelcomeMessage)
   - app/dashboard/page.BACKUP_ETAPA11.tsx (backup)
   ARQUIVOS A MODIFICAR:
   - app/dashboard/page.tsx (reorganizar se√ß√µes)
   RISCO: M√©dio (visual, n√£o regra de neg√≥cio)
   
12) ETAPA 12 - Dashboard Profissional
13) ETAPA 13 - Dashboard White-label (estrutura base)
14) Loja simplificada (2‚Äì3 add-ons reais)
15) Come√ßar teste com 5 usu√°rias beta
16) Integra√ß√£o completa Stripe com novos planos

================================================================================
IDEIAS FUTURAS (N√ÉO IMPLEMENTAR AGORA)
================================================================================

- Vers√£o com voz (transcri√ß√£o de √°udio)
- Vers√£o com imagens (upload de prints)
- App mobile (React Native ou PWA)
- Radar Profissional B2B completo
- Comunidade/f√≥rum entre usu√°rias
- Gamifica√ß√£o avan√ßada
- Integra√ß√µes com calend√°rio

FERRAMENTAS PARA INTEGRAR (GUARDADAS NA MEM√ìRIA):
- Tremor (dashboards bonitos)
- Arcjet (seguran√ßa, rate limiting)
- Crisp/Tawk.to (chatbot frontpage)
- Typebot + Z-API (WhatsApp bot)
- Crisp (helpdesk/suporte)

================================================================================
HIST√ìRICO DE CONCLUS√ïES
================================================================================

[29/11/2025] Sistema de Planos Administr√°veis
- Criadas tabelas billing_plans e billing_plan_promotions
- Criada tela /admin/planos com CRUD completo
- Integra√ß√£o homepage e /planos com hook usePlans
- Suporte a promo√ß√µes com labels e pre√ßos riscados
- Fallback autom√°tico para plans-config.ts

[29/11/2025 21:00] Corre√ß√µes P√≥s-Deploy
- Corrigido acesso admin (getUser em vez de getSession)
- Adicionada migration RLS para admins em billing_plans
- Sistema de Planos 100% funcional em produ√ß√£o

[29/11/2025 21:15] Sistema de Mem√≥ria do Projeto
- Criado ROADMAP-RADAR.txt
- Criado TESTES-RADAR.txt
- Criado script gerar-espelho-codigo.cjs
- Comando: npm run espelho-codigo

[29/11/2025 21:25] Corre√ß√£o Bot√£o Config Menu
- Problema: Bot√£o "Config Menu" no admin usava localhost hardcoded
- Solu√ß√£o: Trocado para caminho relativo /admin/menu-config
- Arquivo: app/admin/AdminClient.tsx

[29/11/2025 22:10] Unifica√ß√£o do Di√°rio
- Arquivadas rotas duplicadas: /diario-premium, /timeline-premium, /linha-tempo
- Movidas para app/_archive/
- Rotas oficiais: /diario, /diario/novo, /diario/[id], /diario/[id]/editar, /diario/timeline
- Atualizados todos os links no dashboard e homepage
- Build passou: 129 p√°ginas (antes 132)

[29/11/2025 22:35] ETAPA 2 - Tri√¢ngulo Clareza ‚áÑ Di√°rio ‚áÑ Chat (COMPLETA)
- Clareza ‚Üí Di√°rio: Ao salvar teste como base, cria entrada autom√°tica (clarity_baseline)
- Di√°rio ‚Üí Chat: Chat recebe contexto dos √∫ltimos 3 epis√≥dios mais intensos
- Clareza ‚Üí Chat: Chat j√° recebia perfil de clareza (confirmado funcionando)
- Di√°rio/Novo: Aceita ?from=clarity_result&clarity_test_id=UUID para pr√©-preencher
- Tipos atualizados: JournalEntryType com 6 tipos (normal, clarity_baseline, chat_summary, etc.)
- Arquivos modificados:
  - app/api/clarity/activate-profile/route.ts
  - app/api/chat/route.ts
  - lib/diary-types.ts
  - app/diario/novo/page.tsx (pr√©-preenchimento via query string)

[29/11/2025 23:15] ETAPA 3 - Di√°rio + Timeline + Dashboard Conectados ao Tri√¢ngulo (COMPLETA)
- Di√°rio com badge "Perfil de Clareza" para entradas clarity_baseline
- Timeline com badge "Perfil de Clareza" + destaque "Intenso" para mood_intensity >= 7
- Dashboard j√° consumia dados reais (confirmado: clarity_tests, journal_entries, ai_messages)
- Tipo JournalEntry em types/database.ts atualizado com entry_type e clarity_test_id
- Rotas antigas j√° estavam em app/_archive/ (diario-premium, timeline-premium, linha-tempo)
- Arquivos modificados:
  - types/database.ts (JournalEntryType adicionado)
  - app/diario/page.tsx (badge clarity_baseline)
  - app/diario/timeline/page.tsx (badge clarity_baseline + mood_intensity)
  - ATLAS-RADAR-NARCISISTA.txt (se√ß√£o Dashboard atualizada)

[30/11/2025 01:00] ETAPA 4 - Chat ‚Üí Di√°rio (COMPLETA)
- API /api/chat/save-summary criada
- Bot√£o "Salvar no Di√°rio" no chat ap√≥s 2+ mensagens
- Modal de resumo com texto, intensidade e tags
- Integra√ß√£o com modal de encerramento
- Badge "Resumo do Chat" no Di√°rio e Timeline
- Arquivos modificados:
  - app/api/chat/save-summary/route.ts (novo)
  - app/chat/page.tsx (modal e bot√£o)
  - app/diario/page.tsx (badge)
  - app/diario/timeline/page.tsx (badge)

[30/11/2025 01:30] ETAPA 5 - Editor Visual da Frontpage (COMPLETA)
- Migration 007_frontpage_config.sql criada
- API /api/admin/frontpage-editor criada (CRUD)
- Editor por formul√°rios: /admin/frontpage-editor
- Editor visual com preview: /admin/frontpage-visual
- Hook useFrontpageConfig.ts criado
- Preview responsivo (desktop/tablet/mobile)
- PENDENTE: Rodar migration no Supabase
- Arquivos criados:
  - database/migrations/007_frontpage_config.sql
  - app/api/admin/frontpage-editor/route.ts
  - app/admin/frontpage-editor/page.tsx
  - app/admin/frontpage-visual/page.tsx
  - hooks/useFrontpageConfig.ts

[30/11/2025 11:30] ETAPA 6 - Tri√¢ngulo V2 (COMPLETA)
- Filtros por entry_type no /diario (clarity_baseline, chat_summary, normal)
- Filtros por entry_type no /diario/timeline
- Legenda do Tri√¢ngulo na Timeline (‚ú® Perfil, üí¨ Chat, üî• Intenso)
- Card "Estado do Tri√¢ngulo" no /dashboard com 3 colunas
- Status din√¢mico: "Tri√¢ngulo Ativo" ou "Incompleto"
- Mensagem explicativa do que falta completar
- PENDENTE-V2: Auto-resumo IA no Chat
- Arquivos modificados:
  - app/diario/page.tsx (filtros por entry_type)
  - app/diario/timeline/page.tsx (filtros + legenda)
  - app/dashboard/page.tsx (card Estado do Tri√¢ngulo)

[30/11/2025 15:20] ETAPA 7.3 - Plano de Seguran√ßa no Tri√¢ngulo (COMPLETA)
- API REST /api/safety-plan criada (GET, POST, PATCH)
- Card "Plano de Seguran√ßa" no Dashboard com status colorido
- Banner de alerta de risco f√≠sico no Dashboard
- Detec√ß√£o de risco f√≠sico no Chat via regex (PHYSICAL_RISK_REGEX)
- Banner de alerta no Chat quando risco f√≠sico detectado
- Cria√ß√£o autom√°tica de risk_alert via Chat
- Badge üõ°Ô∏è "Plano de Seguran√ßa" no Di√°rio e Timeline
- Tipo 'safety_plan' adicionado ao JournalEntryType
- risk_alert autom√°tico quando hasPhysicalRisk no Teste de Clareza
- Build passou: 134 p√°ginas
- Arquivos criados:
  - app/api/safety-plan/route.ts
- Arquivos modificados:
  - types/database.ts
  - app/api/clarity/activate-profile/route.ts
  - app/api/chat/route.ts
  - app/dashboard/page.tsx
  - app/chat/page.tsx
  - app/diario/page.tsx
  - app/diario/timeline/page.tsx

================================================================================
BUGS CONHECIDOS (A CORRIGIR)
================================================================================

Nenhum bug cr√≠tico identificado no momento.

MIGRATIONS PENDENTES:
- 007_frontpage_config.sql ‚Üí Rodar no Supabase Dashboard

================================================================================
FIM DO ROADMAP
================================================================================
